import{r as R,q as X,k as Y,s as Z,a as ee,b as h,e as f,g as ae,d as b,t as $,F as A,f as T,h as C,x as te,m as y,c as H,H as se,z as oe,D as F,I as ne,n as j,J as re,E as le,K as ce,_ as de}from"./index.a968d502.js";import{u as ue,r as me,e as ie,m as pe,a as he,b as ye,c as be,d as O}from"./index.b238c132.js";import{U as J}from"./maska.f37bce9a.js";import{_ as ge}from"./Loader.4becdda6.js";import{h as _e}from"./toast.153b1529.js";const fe={class:"modal fade",id:"modal-form",tabindex:"-1",role:"dialog","aria-labelledby":"modal-form","aria-hidden":"true"},ve={class:"modal-dialog modal-dialog-centered modal-dialog-popin modal-lg",role:"document"},ke={class:"modal-content"},Ve={class:"modal-header"},$e={class:"modal-title"},xe={class:"modal-body"},Me={key:0,class:"form-label"},we=["onUpdate:modelValue","type","placeholder","disabled","data-maska","onBlur"],Be=["onUpdate:modelValue","rows","placeholder","disabled","onBlur"],Ce=["onUpdate:modelValue","disabled","onBlur"],Fe=["value"],Oe={key:7,class:"form-check"},Ee=["onUpdate:modelValue","id","onChange"],Ue=["for"],Ae={key:8,class:"invalid-feedback d-block"},je={directives:{maska:J}},Se=Object.assign(je,{__name:"BaseModalForm",props:{modelValue:{type:Object,default:()=>({})},fields:{type:Array,required:!0},api:{type:Object,required:!0},idField:{type:String,default:"id"},title:{type:String,default:"Editar / Criar"},extraPayload:{type:Object,default:()=>({})}},emits:["update:modelValue","saved","close","create","edit"],setup(S,{expose:K,emit:E}){const u=S;R(!1);const o=X({}),x=(a=!1)=>{var t;u.fields.forEach(r=>{var s;if(r.skipInit)return;const e=r.name;!a&&((s=u.modelValue)==null?void 0:s.hasOwnProperty(e))?o[e]=u.modelValue[e]:r.hasOwnProperty("default")?o[e]=typeof r.default=="function"?r.default():r.default:o[e]=r.multiple?[]:r.type==="checkbox"?!1:null}),!a&&((t=u.modelValue)==null?void 0:t[u.idField])?o[u.idField]=u.modelValue[u.idField]:o[u.idField]=null};x(),Y(()=>u.modelValue,a=>{x(),a&&Object.keys(a).forEach(t=>{o.hasOwnProperty(t)&&(o[t]=a[t])})},{deep:!0,immediate:!0});const M={required:me,email:ie,minLength:pe,maxLength:he,minValue:ye,maxValue:be},I={required:"Campo obrigat\xF3rio",email:"E-mail inv\xE1lido",minLength:a=>`M\xEDnimo de ${a.$params.min} caracteres`,maxLength:a=>`M\xE1ximo de ${a.$params.max} caracteres`,minValue:a=>`O valor m\xEDnimo \xE9 ${a.$params.min}`,maxValue:a=>`O valor m\xE1ximo \xE9 ${a.$params.max}`},w=(a,t,r)=>{if(a)return O.withMessage(a,t);if(I[r]){const e=I[r];return typeof e=="function"?O.withMessage(s=>e(s),t):O.withMessage(e,t)}return O.withMessage("Campo inv\xE1lido",t)};function N(a){if(!a)return null;if(a.includes(":")){const[r,e]=a.split(":"),s=e.split(",").map(n=>{const i=Number(n.trim());return isNaN(i)?n.trim():i});return{name:r.trim(),args:s}}const t=a.match(/^(\w+)\((.*)\)$/);if(t){const r=t[1],e=t[2].split(",").map(s=>{const n=Number(s.trim());return isNaN(n)?s.trim():n});return{name:r,args:e}}return{name:a.trim(),args:[]}}function G(a){var e;const t={};if(!a.rules)return t;const r=a.messages||{};if(Array.isArray(a.rules))return a.rules.forEach((s,n)=>{var i;if(typeof s=="function")t[`r${n}`]=s;else if(typeof s=="string"){const c=N(s);if(!c)return;const l=M[c.name];if(!l)return;const p=(i=c.args)!=null&&i.length?l(...c.args):l;t[c.name]=w(r[c.name],p,c.name)}else s&&typeof s=="object"&&Object.entries(s).forEach(([c,l])=>{const p=M[c];if(!p)return;let v,k=r[c];if(typeof l=="object"&&l!==null){const V=Array.isArray(l.value)?l.value:l.value!==void 0?[l.value]:l.args||[];k=l.message||k,v=V.length?p(...V):p}else l===!0||l===void 0?v=p:v=p(l);t[c]=w(k,v,c)})}),t;if(typeof a.rules=="object")return Object.entries(a.rules).forEach(([s,n])=>{const i=M[s];if(!i)return;let c,l=r[s];if(typeof n=="object"&&n!==null){const p=Array.isArray(n.value)?n.value:n.value!==void 0?[n.value]:n.args||[];l=n.message||l,c=p.length?i(...p):i}else n===!0||n===void 0?c=i:c=i(n);t[s]=w(l,c,s)}),t;if(typeof a.rules=="string"){const s=N(a.rules);if(s){const n=M[s.name];if(n){const i=(e=s.args)!=null&&e.length?n(...s.args):n;t[s.name]=w(r[s.name],i,s.name)}}}return t}const Q=Z(()=>{const a={};return u.fields.forEach(t=>{a[t.name]=G(t)}),a}),m=ue(Q,o),B=R(null),W=async()=>{var e;if(B.value.loaderOn(),m.value.$touch(),!await m.value.$validate()){B.value.loaderOff();return}let t;const r={...o,...u.extraPayload};o[u.idField]?t=await u.api.update(o[u.idField],r):t=await u.api.save(r),_e(t,"Altera\xE7\xF5es salvas com sucesso"),t!=null&&t.success&&(E("saved",(e=t.data)!=null?e:o),U()),B.value.loaderOff()};K({openModal:(a=!1)=>{x(a),m.value.$reset(),new bootstrap.Modal(document.getElementById("modal-form")).show(),E(a?"create":"edit",o)}});const U=()=>{x(!1),m.value.$reset();const a=document.getElementById("modal-form"),t=bootstrap.Modal.getInstance(a);t&&t.hide(),E("close")};return(a,t)=>{const r=ee("VAsyncSelect");return h(),f(A,null,[ae(ge,{ref_key:"loader",ref:B},null,512),b("div",fe,[b("div",ve,[b("div",ke,[b("div",Ve,[b("h5",$e,$(o[u.idField]?"Editar":"Criar"),1),b("button",{type:"button",class:"btn-close",onClick:U})]),b("div",xe,[(h(!0),f(A,null,T(S.fields,e=>{var s,n,i,c,l,p,v,k,V,D,P,q,L,z;return h(),f("div",{key:e.name,class:"mb-3"},[e.type!=="checkbox"?(h(),f("label",Me,$(e.label),1)):C("",!0),e.slot?te(a.$slots,e.slot,{key:1,field:e,model:o,v:y(m)},void 0,!0):e.component?(h(),H(oe(e.component),se({key:2,modelValue:o[e.name],"onUpdate:modelValue":d=>o[e.name]=d},e.props,{class:[e.class,{"is-invalid":((n=(s=y(m))==null?void 0:s[e.name])==null?void 0:n.$error)&&e.addInvalidClass!==!1}],onBlur:d=>{var g,_;return(_=(g=y(m))==null?void 0:g[e.name])==null?void 0:_.$touch()}}),null,16,["modelValue","onUpdate:modelValue","class","onBlur"])):["text","email","number","password","date","tel"].includes(e.type)?F((h(),f("input",{key:3,"onUpdate:modelValue":d=>o[e.name]=d,type:e.type,class:j(["form-control",{"is-invalid":(c=(i=y(m))==null?void 0:i[e.name])==null?void 0:c.$errors.length}]),placeholder:e.placeholder,disabled:e.disabled,"data-maska":e.mask,onBlur:(p=(l=y(m))==null?void 0:l[e.name])==null?void 0:p.$touch},null,42,we)),[[ne,o[e.name]],[y(J)]]):e.type==="textarea"?F((h(),f("textarea",{key:4,"onUpdate:modelValue":d=>o[e.name]=d,class:j(["form-control",{"is-invalid":(k=(v=y(m))==null?void 0:v[e.name])==null?void 0:k.$error}]),rows:e.rows||3,placeholder:e.placeholder,disabled:e.disabled,onBlur:d=>{var g,_;return(_=(g=y(m))==null?void 0:g[e.name])==null?void 0:_.$touch()}},null,42,Be)),[[re,o[e.name]]]):e.type==="select"?F((h(),f("select",{key:5,"onUpdate:modelValue":d=>o[e.name]=d,class:j(["form-select",{"is-invalid":(D=(V=y(m))==null?void 0:V[e.name])==null?void 0:D.$error}]),disabled:e.disabled,onBlur:d=>{var g,_;return(_=(g=y(m))==null?void 0:g[e.name])==null?void 0:_.$touch()}},[(h(!0),f(A,null,T(e.options||[],d=>(h(),f("option",{key:d.value,value:d.value},$(d.label),9,Fe))),128))],42,Ce)),[[le,o[e.name]]]):C("",!0),e.type==="async-select"?(h(),H(r,{key:6,entity:e.entity,modelValue:o[e.name],"onUpdate:modelValue":d=>o[e.name]=d,"pre-filled-value":o[e.name]},null,8,["entity","modelValue","onUpdate:modelValue","pre-filled-value"])):e.type==="checkbox"?(h(),f("div",Oe,[F(b("input",{"onUpdate:modelValue":d=>o[e.name]=d,type:"checkbox",class:"form-check-input",id:e.name,onChange:d=>{var g,_;return(_=(g=y(m))==null?void 0:g[e.name])==null?void 0:_.$touch()}},null,40,Ee),[[ce,o[e.name]]]),b("label",{class:"form-check-label",for:e.name},$(e.label),9,Ue)])):C("",!0),(q=(P=y(m))==null?void 0:P[e.name])!=null&&q.$errors.length?(h(),f("div",Ae,$(((z=(L=y(m)[e.name].$errors)==null?void 0:L[0])==null?void 0:z.$message)||e.errorMessage||"Campo inv\xE1lido"),1)):C("",!0)])}),128))]),b("div",{class:"modal-footer"},[b("button",{type:"button",class:"btn btn-danger btn-lg",onClick:U},"Cancelar"),b("button",{type:"button",class:"btn btn-success btn-lg",onClick:W},"Salvar")])])])])],64)}}}),ze=de(Se,[["__scopeId","data-v-65028289"]]);export{ze as B};
