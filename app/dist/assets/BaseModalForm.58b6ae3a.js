import{r as W,q as X,k as Y,s as Z,a as ee,b as h,e as v,g as ae,d as b,t as $,F as O,f as R,h as C,x as te,m as y,c as T,H as se,z as oe,D as F,I as ne,n as j,J as re,E as le,K as ce,_ as de}from"./index.1cfa7469.js";import{u as ue,r as ie,e as me,m as pe,a as he,b as ye,c as be,d as E}from"./index.26f640d7.js";import{U as H}from"./maska.f37bce9a.js";import{_ as ge}from"./Loader.7b3789d0.js";import{h as _e}from"./toast.022af5e3.js";const ve={class:"modal fade",id:"modal-form",tabindex:"-1",role:"dialog","aria-labelledby":"modal-form","aria-hidden":"true"},fe={class:"modal-dialog modal-dialog-centered modal-dialog-popin modal-lg",role:"document"},ke={class:"modal-content"},Ve={class:"modal-header"},$e={class:"modal-title"},xe={class:"modal-body"},Me={key:0,class:"form-label"},we=["onUpdate:modelValue","type","placeholder","disabled","data-maska","onBlur"],Be=["onUpdate:modelValue","rows","placeholder","disabled","onBlur"],Ce=["onUpdate:modelValue","disabled","onBlur"],Fe=["value"],Ee={key:7,class:"form-check"},Ue=["onUpdate:modelValue","id","onChange"],Ae=["for"],Oe={key:8,class:"invalid-feedback d-block"},je={directives:{maska:H}},Se=Object.assign(je,{__name:"BaseModalForm",props:{modelValue:{type:Object,default:()=>({})},fields:{type:Array,required:!0},api:{type:Object,required:!0},idField:{type:String,default:"id"},title:{type:String,default:"Editar / Criar"},extraPayload:{type:Object,default:()=>({})}},emits:["update:modelValue","saved","close","create","edit"],setup(S,{expose:J,emit:U}){const u=S,x=W(!1),o=X({}),M=(a=!1)=>{var t;u.fields.forEach(r=>{var s;if(r.skipInit)return;const e=r.name;!a&&((s=u.modelValue)==null?void 0:s.hasOwnProperty(e))?o[e]=u.modelValue[e]:r.hasOwnProperty("default")?o[e]=typeof r.default=="function"?r.default():r.default:o[e]=r.multiple?[]:r.type==="checkbox"?!1:null}),!a&&((t=u.modelValue)==null?void 0:t[u.idField])?o[u.idField]=u.modelValue[u.idField]:o[u.idField]=null};M(),Y(()=>u.modelValue,a=>{M(),a&&Object.keys(a).forEach(t=>{o.hasOwnProperty(t)&&(o[t]=a[t])})},{deep:!0,immediate:!0});const w={required:ie,email:me,minLength:pe,maxLength:he,minValue:ye,maxValue:be},I={required:"Campo obrigat\xF3rio",email:"E-mail inv\xE1lido",minLength:a=>`M\xEDnimo de ${a.$params.min} caracteres`,maxLength:a=>`M\xE1ximo de ${a.$params.max} caracteres`,minValue:a=>`O valor m\xEDnimo \xE9 ${a.$params.min}`,maxValue:a=>`O valor m\xE1ximo \xE9 ${a.$params.max}`},B=(a,t,r)=>{if(a)return E.withMessage(a,t);if(I[r]){const e=I[r];return typeof e=="function"?E.withMessage(s=>e(s),t):E.withMessage(e,t)}return E.withMessage("Campo inv\xE1lido",t)};function N(a){if(!a)return null;if(a.includes(":")){const[r,e]=a.split(":"),s=e.split(",").map(n=>{const m=Number(n.trim());return isNaN(m)?n.trim():m});return{name:r.trim(),args:s}}const t=a.match(/^(\w+)\((.*)\)$/);if(t){const r=t[1],e=t[2].split(",").map(s=>{const n=Number(s.trim());return isNaN(n)?s.trim():n});return{name:r,args:e}}return{name:a.trim(),args:[]}}function K(a){var e;const t={};if(!a.rules)return t;const r=a.messages||{};if(Array.isArray(a.rules))return a.rules.forEach((s,n)=>{var m;if(typeof s=="function")t[`r${n}`]=s;else if(typeof s=="string"){const c=N(s);if(!c)return;const l=w[c.name];if(!l)return;const p=(m=c.args)!=null&&m.length?l(...c.args):l;t[c.name]=B(r[c.name],p,c.name)}else s&&typeof s=="object"&&Object.entries(s).forEach(([c,l])=>{const p=w[c];if(!p)return;let f,k=r[c];if(typeof l=="object"&&l!==null){const V=Array.isArray(l.value)?l.value:l.value!==void 0?[l.value]:l.args||[];k=l.message||k,f=V.length?p(...V):p}else l===!0||l===void 0?f=p:f=p(l);t[c]=B(k,f,c)})}),t;if(typeof a.rules=="object")return Object.entries(a.rules).forEach(([s,n])=>{const m=w[s];if(!m)return;let c,l=r[s];if(typeof n=="object"&&n!==null){const p=Array.isArray(n.value)?n.value:n.value!==void 0?[n.value]:n.args||[];l=n.message||l,c=p.length?m(...p):m}else n===!0||n===void 0?c=m:c=m(n);t[s]=B(l,c,s)}),t;if(typeof a.rules=="string"){const s=N(a.rules);if(s){const n=w[s.name];if(n){const m=(e=s.args)!=null&&e.length?n(...s.args):n;t[s.name]=B(r[s.name],m,s.name)}}}return t}const G=Z(()=>{const a={};return u.fields.forEach(t=>{a[t.name]=K(t)}),a}),i=ue(G,o),Q=async()=>{var e;if(x.value=!0,i.value.$touch(),!await i.value.$validate()){x.value=!1;return}let t;const r={...o,...u.extraPayload};o[u.idField]?t=await u.api.update(o[u.idField],r):t=await u.api.save(r),_e(t,"Altera\xE7\xF5es salvas com sucesso"),t!=null&&t.success&&(U("saved",(e=t.data)!=null?e:o),A()),x.value=!1};J({openModal:(a=!1)=>{M(a),i.value.$reset(),new bootstrap.Modal(document.getElementById("modal-form")).show(),U(a?"create":"edit",o)}});const A=()=>{M(!1),i.value.$reset();const a=document.getElementById("modal-form"),t=bootstrap.Modal.getInstance(a);t&&t.hide(),U("close")};return(a,t)=>{const r=ee("VAsyncSelect");return h(),v(O,null,[ae(ge,{loading:x.value},null,8,["loading"]),b("div",ve,[b("div",fe,[b("div",ke,[b("div",Ve,[b("h5",$e,$(o[u.idField]?"Editar":"Criar"),1),b("button",{type:"button",class:"btn-close",onClick:A})]),b("div",xe,[(h(!0),v(O,null,R(S.fields,e=>{var s,n,m,c,l,p,f,k,V,D,L,P,q,z;return h(),v("div",{key:e.name,class:"mb-3"},[e.type!=="checkbox"?(h(),v("label",Me,$(e.label),1)):C("",!0),e.slot?te(a.$slots,e.slot,{key:1,field:e,model:o,v:y(i)},void 0,!0):e.component?(h(),T(oe(e.component),se({key:2,modelValue:o[e.name],"onUpdate:modelValue":d=>o[e.name]=d},e.props,{class:[e.class,{"is-invalid":((n=(s=y(i))==null?void 0:s[e.name])==null?void 0:n.$error)&&e.addInvalidClass!==!1}],onBlur:d=>{var g,_;return(_=(g=y(i))==null?void 0:g[e.name])==null?void 0:_.$touch()}}),null,16,["modelValue","onUpdate:modelValue","class","onBlur"])):["text","email","number","password","date","tel"].includes(e.type)?F((h(),v("input",{key:3,"onUpdate:modelValue":d=>o[e.name]=d,type:e.type,class:j(["form-control",{"is-invalid":(c=(m=y(i))==null?void 0:m[e.name])==null?void 0:c.$errors.length}]),placeholder:e.placeholder,disabled:e.disabled,"data-maska":e.mask,onBlur:(p=(l=y(i))==null?void 0:l[e.name])==null?void 0:p.$touch},null,42,we)),[[ne,o[e.name]],[y(H)]]):e.type==="textarea"?F((h(),v("textarea",{key:4,"onUpdate:modelValue":d=>o[e.name]=d,class:j(["form-control",{"is-invalid":(k=(f=y(i))==null?void 0:f[e.name])==null?void 0:k.$error}]),rows:e.rows||3,placeholder:e.placeholder,disabled:e.disabled,onBlur:d=>{var g,_;return(_=(g=y(i))==null?void 0:g[e.name])==null?void 0:_.$touch()}},null,42,Be)),[[re,o[e.name]]]):e.type==="select"?F((h(),v("select",{key:5,"onUpdate:modelValue":d=>o[e.name]=d,class:j(["form-select",{"is-invalid":(D=(V=y(i))==null?void 0:V[e.name])==null?void 0:D.$error}]),disabled:e.disabled,onBlur:d=>{var g,_;return(_=(g=y(i))==null?void 0:g[e.name])==null?void 0:_.$touch()}},[(h(!0),v(O,null,R(e.options||[],d=>(h(),v("option",{key:d.value,value:d.value},$(d.label),9,Fe))),128))],42,Ce)),[[le,o[e.name]]]):C("",!0),e.type==="async-select"?(h(),T(r,{key:6,entity:e.entity,modelValue:o[e.name],"onUpdate:modelValue":d=>o[e.name]=d,"pre-filled-value":o[e.name]},null,8,["entity","modelValue","onUpdate:modelValue","pre-filled-value"])):e.type==="checkbox"?(h(),v("div",Ee,[F(b("input",{"onUpdate:modelValue":d=>o[e.name]=d,type:"checkbox",class:"form-check-input",id:e.name,onChange:d=>{var g,_;return(_=(g=y(i))==null?void 0:g[e.name])==null?void 0:_.$touch()}},null,40,Ue),[[ce,o[e.name]]]),b("label",{class:"form-check-label",for:e.name},$(e.label),9,Ae)])):C("",!0),(P=(L=y(i))==null?void 0:L[e.name])!=null&&P.$errors.length?(h(),v("div",Oe,$(((z=(q=y(i)[e.name].$errors)==null?void 0:q[0])==null?void 0:z.$message)||e.errorMessage||"Campo inv\xE1lido"),1)):C("",!0)])}),128))]),b("div",{class:"modal-footer"},[b("button",{type:"button",class:"btn btn-danger btn-lg",onClick:A},"Cancelar"),b("button",{type:"button",class:"btn btn-success btn-lg",onClick:Q},"Salvar")])])])])],64)}}}),ze=de(Se,[["__scopeId","data-v-13911dd5"]]);export{ze as B};
