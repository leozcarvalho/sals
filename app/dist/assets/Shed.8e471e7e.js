import{_ as E,u as G,A as k,r as A,q as N,o as T,b as r,e as _,d as e,t as b,m as q,F as C,f as w,G as j,g as O,a_ as U,aZ as Z}from"./index.4aae8c21.js";import{B as z}from"./BaseModalForm.fea5d55b.js";import{h as H}from"./toast.a6367562.js";import{_ as F}from"./PinSelect.4918bbaa.js";import"./index.607cd4df.js";import"./maska.f37bce9a.js";import"./Loader.993b0747.js";const l=f=>(U("data-v-4bb14181"),f=f(),Z(),f),J={class:"container py-4"},K={class:"mb-4"},Q={class:"d-flex justify-content-between align-items-center mb-2"},W={class:"mb-0"},X=["data-bs-target","aria-controls"],Y=l(()=>e("i",{class:"fa fa-chevron-down"},null,-1)),ee=[Y],te=["onClick"],se=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),ne=[se],ae=["onClick"],oe=l(()=>e("i",{class:"fa fa-trash"},null,-1)),le=[oe],ie=["onClick"],de=["id"],ce={class:"d-flex justify-content-between align-items-center"},re=["onClick"],_e=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),me=[_e],ue=["onClick"],be=l(()=>e("i",{class:"fa fa-trash"},null,-1)),pe=[be],fe=["onClick"],he={class:"d-flex justify-content-between align-items-center"},ve=["onClick"],ye=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),ge=[ye],ke=["onClick"],Ce=l(()=>e("i",{class:"fa fa-trash"},null,-1)),we=[Ce],xe=["onClick"],Ie={class:"mt-2 ms-3 row"},$e={class:"btn btn-lg btn-primary disabled me-2"},Pe=["onClick"],Se=l(()=>e("i",{class:"fa fa-trash"},null,-1)),Ae=[Se],qe={class:"modal fade",id:"modal-delete",tabindex:"-1"},Be={class:"modal-dialog"},Ve={class:"modal-content"},De=l(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Confirmar A\xE7\xE3o"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),Ne={class:"modal-body"},je=l(()=>e("button",{class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),Fe={__name:"Shed",setup(f){const M=G(),x=new k("/shed-rooms"),I=new k("/room-stalls"),$=new k("/stall-feeders"),B=new k("/feeder-valves"),h=M.query.id,V=A([]),D=A(null),a=N({type:null,entity:null,parentId:null}),i=N({type:null,entity:null}),P=async()=>{const t=(await x.getList({shed_id:h})).data.items||[];await Promise.all(t.map(async d=>{const y=await I.getList({shed_room_id:d.id});d.stalls=y.data.items||[],await Promise.all(d.stalls.map(async p=>{const g=await $.getList({room_stall_id:p.id});p.feeders=g.data.items||[]}))})),V.value=t};T(async()=>{await P()});const m=(n,t=null,d=null)=>{Object.assign(a,{type:n,entity:t!=null?t:{},parentId:d}),D.value.openModal()},R=async()=>{await P()},v=(n,t)=>{i.type=n,i.entity=t,new bootstrap.Modal(document.getElementById("modal-delete")).show()},L=async()=>{let n;i.type==="room"?n=x:i.type==="stall"?n=I:i.type==="feeder"?n=$:n=B;const t=await n.delete(i.entity.id);H(t,"Item exclu\xEDdo com sucesso"),t.success&&(await P(),i.type=null,i.entity=null)},S=A({room:{api:x,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"entrance_pin_id",label:"Pino de Entrada",component:F}],extraPayload:()=>({shed_id:a.parentId})},stall:{api:I,fields:[{name:"name",label:"Nome",type:"text",rules:"required"}],extraPayload:()=>({shed_room_id:a.parentId})},feeder:{api:$,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"max_weight",label:"Peso m\xE1ximo (kg)",type:"number",rules:"required|numeric|min:0"}],extraPayload:()=>({room_stall_id:a.parentId})},valve:{api:B,fields:[{name:"device_pin_id",label:"Pino do Dispositivo",component:F,rules:"required"}],extraPayload:()=>({stall_feeder_id:a.parentId})}});return(n,t)=>{var d,y,p,g;return r(),_("div",J,[e("h3",K,"Galp\xE3o #"+b(q(h)),1),e("button",{class:"btn btn-success mb-3",onClick:t[0]||(t[0]=s=>m("room",null,q(h)))}," + Sala "),(r(!0),_(C,null,w(V.value,s=>(r(),_("div",{key:s.id,class:"card mb-3 p-3 shadow-sm room-card"},[e("div",Q,[e("h5",W,b(s.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-info me-1",type:"button","data-bs-toggle":"collapse","data-bs-target":"#room-"+s.id,"aria-expanded":"false","aria-controls":"room-"+s.id},ee,8,X),e("button",{class:"btn btn-lg btn-warning",onClick:o=>m("room",s,q(h))},ne,8,te),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:o=>v("room",s)},le,8,ae),e("button",{class:"btn btn-lg btn-success ms-1",onClick:o=>m("stall",null,s.id)}," + Baia ",8,ie)])]),e("div",{class:"collapse",id:"room-"+s.id},[(r(!0),_(C,null,w(s.stalls,o=>(r(),_("div",{key:o.id,class:"card mb-2 ms-3 p-2 shadow-sm stall-card"},[e("div",ce,[e("strong",null,b(o.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:c=>m("stall",o,s.id)},me,8,re),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:c=>v("stall",o)},pe,8,ue),e("button",{class:"btn btn-lg btn-success ms-1",onClick:c=>m("feeder",null,o.id)}," + Comedouro ",8,fe)])]),(r(!0),_(C,null,w(o.feeders,c=>(r(),_("div",{key:c.id,class:"card mt-2 ms-3 p-2 feeder-card"},[e("div",he,[e("span",null,b(c.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:u=>m("feeder",c,o.id)},ge,8,ve),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:u=>v("feeder",c)},we,8,ke),e("button",{class:"btn btn-lg btn-success ms-1",onClick:u=>m("valve",null,c.id)}," + V\xE1lvula ",8,xe)])]),e("div",Ie,[(r(!0),_(C,null,w(c.device_pins,u=>(r(),_("div",{key:u.id,class:"d-flex align-items-center mb-1 col-auto"},[e("button",$e,b(u.pin.name),1),e("button",{class:"btn btn-lg btn-danger",onClick:Me=>v("feeder-valves",u)},Ae,8,Pe)]))),128))])]))),128))]))),128))],8,de)]))),128)),e("div",qe,[e("div",Be,[e("div",Ve,[De,e("div",Ne,[j(" Deseja realmente excluir "),e("strong",null,b(((d=i.entity)==null?void 0:d.name)||"este item"),1),j("? ")]),e("div",{class:"modal-footer"},[je,e("button",{class:"btn btn-danger","data-bs-dismiss":"modal",onClick:L},"Confirmar")])])])]),O(z,{ref_key:"modalForm",ref:D,modelValue:a.entity,"onUpdate:modelValue":t[1]||(t[1]=s=>a.entity=s),fields:((y=S.value[a.type])==null?void 0:y.fields)||[],api:((p=S.value[a.type])==null?void 0:p.api)||{},"extra-payload":(g=S.value[a.type])==null?void 0:g.extraPayload(),onSaved:R},null,8,["modelValue","fields","api","extra-payload"])])}}},Ze=E(Fe,[["__scopeId","data-v-4bb14181"]]);export{Ze as default};
