import{_ as U,u as Z,A as y,r as T,q as N,o as z,b as c,e as r,d as e,t as b,m as j,F as x,f as I,G as D,g as H,a_ as J,aZ as K}from"./index.1de81d9c.js";import{B as Q}from"./BaseModalForm.37c03ed5.js";import{h as W}from"./toast.1c03bdcb.js";import{_ as F}from"./PinSelect.7fe157fe.js";import{_ as h}from"./NumericInput.efd2cf3f.js";import"./index.2f424ca5.js";import"./Loader.5f66cc62.js";const l=g=>(J("data-v-403d93f2"),g=g(),K(),g),X={class:"container py-4"},Y={class:"mb-4"},ee={class:"d-flex justify-content-between align-items-center mb-2"},te={class:"mb-0"},se=["data-bs-target","aria-controls"],ne=l(()=>e("i",{class:"fa fa-chevron-down"},null,-1)),ae=[ne],oe=["onClick"],le=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),ie=[le],de=["onClick"],ce=l(()=>e("i",{class:"fa fa-trash"},null,-1)),re=[ce],me=["onClick"],_e=["id"],ue={class:"d-flex justify-content-between align-items-center"},pe=["onClick"],be=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),he=[be],fe=["onClick"],ve=l(()=>e("i",{class:"fa fa-trash"},null,-1)),ye=[ve],ge=["onClick"],ke={class:"d-flex justify-content-between align-items-center"},Ce=["onClick"],we=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),xe=[we],Ie=["onClick"],$e=l(()=>e("i",{class:"fa fa-trash"},null,-1)),Se=[$e],Ae=["onClick"],Pe={class:"mt-2 ms-3 row"},Te={class:"btn btn-lg btn-primary disabled me-2"},Ve=["onClick"],qe=l(()=>e("i",{class:"fa fa-trash"},null,-1)),Be=[qe],Ee={class:"modal fade",id:"modal-delete",tabindex:"-1"},Ne={class:"modal-dialog"},je={class:"modal-content"},De=l(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Confirmar A\xE7\xE3o"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),Fe={class:"modal-body"},Me=l(()=>e("button",{class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),Le={__name:"Shed",setup(g){const M=Z(),L=new y("/sheds"),V=new y("/salas"),q=new y("/baias"),B=new y("/comedouros"),$=new y("/feeder-valves"),S=M.query.id,k=T({}),E=T(null),a=N({type:null,entity:null,parentId:null}),i=N({type:null,entity:null}),G=async n=>(await $.getList({comedouro_id:n})).data.items||[],A=async()=>{var t;const n=await L.get(S);k.value=n.data||{},(t=k.value.salas)==null||t.forEach(_=>{var f;(f=_.baias)==null||f.forEach(w=>{var v;(v=w.comedouros)==null||v.forEach(async s=>{s.device_pins=await G(s.id)})})})};z(async()=>{await A()});const m=(n,t=null,_=null)=>{Object.assign(a,{type:n,entity:t!=null?t:{},parentId:_}),E.value.openModal()},O=async()=>{await A()},C=(n,t)=>{i.type=n,i.entity=t,new bootstrap.Modal(document.getElementById("modal-delete")).show()},R=async()=>{let n;i.type==="sala"?n=V:i.type==="baia"?n=q:i.type==="comedouro"?n=B:n=$;const t=await n.delete(i.entity.id);W(t,"Item exclu\xEDdo com sucesso"),t.success&&(await A(),i.type=null,i.entity=null)},u={type:"decimal",step:"0.01",max:"100"},P=T({sala:{api:V,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"entrance_pin_id",label:"Pino de Entrada",component:F}],extraPayload:()=>({shed_id:a.parentId})},baia:{api:q,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"t1",label:"T1",component:h,props:u},{name:"t2",label:"T2",component:h,props:u},{name:"t3",label:"T3",component:h,props:u},{name:"t4",label:"T4",component:h,props:u},{name:"t5",label:"T5",component:h,props:u},{name:"t6",label:"T6",component:h,props:u}],extraPayload:()=>({sala_id:a.parentId})},comedouro:{api:B,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"max_weight",label:"Peso m\xE1ximo (kg)",type:"number",rules:"required|numeric|min:0"}],extraPayload:()=>({baia_id:a.parentId})},valve:{api:$,fields:[{name:"device_pin_id",label:"Pino do Dispositivo",component:F,rules:"required"}],extraPayload:()=>({comedouro_id:a.parentId})}});return(n,t)=>{var _,f,w,v;return c(),r("div",X,[e("h3",Y,b(k.value.name),1),e("button",{class:"btn btn-success mb-3",onClick:t[0]||(t[0]=s=>m("sala",null,j(S)))}," + Sala "),(c(!0),r(x,null,I(k.value.salas,s=>(c(),r("div",{key:s.id,class:"card mb-3 p-3 shadow-sm sala-card"},[e("div",ee,[e("h5",te,b(s.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-info me-1",type:"button","data-bs-toggle":"collapse","data-bs-target":"#sala-"+s.id,"aria-expanded":"true","aria-controls":"sala-"+s.id},ae,8,se),e("button",{class:"btn btn-lg btn-warning",onClick:o=>m("sala",s,j(S))},ie,8,oe),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:o=>C("sala",s)},re,8,de),e("button",{class:"btn btn-lg btn-success ms-1",onClick:o=>m("baia",null,s.id)}," + Baia ",8,me)])]),e("div",{class:"collapse",id:"sala-"+s.id},[(c(!0),r(x,null,I(s.baias,o=>(c(),r("div",{key:o.id,class:"card mb-2 ms-3 p-2 shadow-sm baia-card"},[e("div",ue,[e("strong",null,b(o.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:d=>m("baia",o,s.id)},he,8,pe),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:d=>C("baia",o)},ye,8,fe),e("button",{class:"btn btn-lg btn-success ms-1",onClick:d=>m("comedouro",null,o.id)}," + Comedouro ",8,ge)])]),(c(!0),r(x,null,I(o.comedouros,d=>(c(),r("div",{key:d.id,class:"card mt-2 ms-3 p-2 comedouro-card"},[e("div",ke,[e("span",null,b(d.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:p=>m("comedouro",d,o.id)},xe,8,Ce),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:p=>C("comedouro",d)},Se,8,Ie),e("button",{class:"btn btn-lg btn-success ms-1",onClick:p=>m("valve",null,d.id)}," + V\xE1lvula ",8,Ae)])]),e("div",Pe,[(c(!0),r(x,null,I(d.device_pins,p=>(c(),r("div",{key:p.id,class:"d-flex align-items-center mb-1 col-auto"},[e("button",Te,b(p.device_pin.name),1),e("button",{class:"btn btn-lg btn-danger",onClick:Ge=>C("feeder-valves",p)},Be,8,Ve)]))),128))])]))),128))]))),128))],8,_e)]))),128)),e("div",Ee,[e("div",Ne,[e("div",je,[De,e("div",Fe,[D(" Deseja realmente excluir "),e("strong",null,b(((_=i.entity)==null?void 0:_.name)||"este item"),1),D("? ")]),e("div",{class:"modal-footer"},[Me,e("button",{class:"btn btn-danger","data-bs-dismiss":"modal",onClick:R},"Confirmar")])])])]),H(Q,{ref_key:"modalForm",ref:E,modelValue:a.entity,"onUpdate:modelValue":t[1]||(t[1]=s=>a.entity=s),fields:((f=P.value[a.type])==null?void 0:f.fields)||[],api:((w=P.value[a.type])==null?void 0:w.api)||{},"extra-payload":(v=P.value[a.type])==null?void 0:v.extraPayload(),onSaved:O},null,8,["modelValue","fields","api","extra-payload"])])}}},Ke=U(Le,[["__scopeId","data-v-403d93f2"]]);export{Ke as default};
