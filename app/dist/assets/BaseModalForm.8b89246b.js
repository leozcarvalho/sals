import{r as Q,q as oe,k as re,s as le,a as ie,b as M,e as w,g as ue,d as V,t as j,F as W,f as X,h as T,x as ce,m as E,c as Y,H as de,z as me,D as N,I as pe,n as q,J as he,E as ke,K as ge,_ as fe}from"./index.0a935b94.js";import{u as ye,r as ve,e as be,m as _e,a as Me,b as Ee,c as Ve,d as L}from"./index.7ebf2a24.js";import{_ as $e}from"./Loader.232eaff5.js";import{h as Ae}from"./toast.cd5fee6e.js";/*! maska v2.1.9 | (c) Alexander Shabunevich | Released under the MIT license */var we=Object.defineProperty,xe=(l,a,e)=>a in l?we(l,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[a]=e,F=(l,a,e)=>(xe(l,typeof a!="symbol"?a+"":a,e),e);const ee={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class te{constructor(a={}){var s;F(this,"opts",{}),F(this,"memo",new Map);const e={...a};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...ee,...e.tokens};for(const n of Object.values(e.tokens))typeof n.pattern=="string"&&(n.pattern=new RegExp(n.pattern))}else e.tokens=ee;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((n,u)=>n.length-u.length):e.mask=(s=e.mask[0])!=null?s:""),e.mask===""&&(e.mask=null),this.opts=e}masked(a){return this.process(a,this.findMask(a))}unmasked(a){return this.process(a,this.findMask(a),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(a){const e=this.findMask(a);if(this.opts.mask==null||e==null)return!1;const s=this.process(a,e).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:typeof this.opts.mask=="function"?s>=e.length:this.opts.mask.filter(n=>s>=n.length).length===this.opts.mask.length}findMask(a){var n,u;const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(a);const s=this.process(a,(n=e.slice(-1).pop())!=null?n:"",!1);return(u=e.find(m=>this.process(a,m,!1).length>=s.length))!=null?u:""}escapeMask(a){const e=[],s=[];return a.split("").forEach((n,u)=>{n==="!"&&a[u-1]!=="!"?s.push(u-s.length):e.push(n)}),{mask:e.join(""),escaped:s}}process(a,e,s=!0){var n;if(e==null)return a;const u=`value=${a},mask=${e},masked=${s?1:0}`;if(this.memo.has(u))return this.memo.get(u);const{mask:m,escaped:v}=this.escapeMask(e),b=[],x=this.opts.tokens!=null?this.opts.tokens:{},g=this.isReversed()?-1:1,O=this.isReversed()?"unshift":"push",h=this.isReversed()?0:m.length-1,S=this.isReversed()?()=>o>-1&&r>-1:()=>o<m.length&&r<a.length,I=c=>!this.isReversed()&&c<=h||this.isReversed()&&c>=h;let P,C=-1,o=this.isReversed()?m.length-1:0,r=this.isReversed()?a.length-1:0;for(;S();){const c=m.charAt(o),t=x[c],i=(t==null?void 0:t.transform)!=null?t.transform(a.charAt(r)):a.charAt(r);if(!v.includes(o)&&t!=null){if(i.match(t.pattern)!=null)b[O](i),t.repeated?(C===-1?C=o:o===h&&o!==C&&(o=C-g),h===C&&(o-=g)):t.multiple&&(o-=g),o+=g;else if(t.multiple){const d=((n=b[r-g])==null?void 0:n.match(t.pattern))!=null,f=m.charAt(o+g);d&&f!==""&&x[f]==null?(o+=g,r-=g):b[O]("")}else i===P?P=void 0:t.optional&&(o+=g,r-=g);r+=g}else s&&!this.isEager()&&b[O](c),i===c&&!this.isEager()?r+=g:P=c,this.isEager()||(o+=g);if(this.isEager())for(;I(o)&&(x[m.charAt(o)]==null||v.includes(o));)s?b[O](m.charAt(o)):m.charAt(o)===a.charAt(r)&&(r+=g),o+=g}return this.memo.set(u,b.join("")),this.memo.get(u)}}const ae=l=>JSON.parse(l.replaceAll("'",'"')),se=(l,a={})=>{const e={...a};return l.dataset.maska!=null&&l.dataset.maska!==""&&(e.mask=Oe(l.dataset.maska)),l.dataset.maskaEager!=null&&(e.eager=D(l.dataset.maskaEager)),l.dataset.maskaReversed!=null&&(e.reversed=D(l.dataset.maskaReversed)),l.dataset.maskaTokensReplace!=null&&(e.tokensReplace=D(l.dataset.maskaTokensReplace)),l.dataset.maskaTokens!=null&&(e.tokens=Ce(l.dataset.maskaTokens)),e},D=l=>l!==""?!!JSON.parse(l):!0,Oe=l=>l.startsWith("[")&&l.endsWith("]")?ae(l):l,Ce=l=>{if(l.startsWith("{")&&l.endsWith("}"))return ae(l);const a={};return l.split("|").forEach(e=>{const s=e.split(":");a[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),a};class Re{constructor(a,e={}){F(this,"items",new Map),F(this,"beforeinputEvent",s=>{const n=s.target,u=this.items.get(n);u.isEager()&&"inputType"in s&&s.inputType.startsWith("delete")&&u.unmasked(n.value).length<=1&&this.setMaskedValue(n,"")}),F(this,"inputEvent",s=>{if(s instanceof CustomEvent&&s.type==="input"&&s.detail!=null&&typeof s.detail=="object"&&"masked"in s.detail)return;const n=s.target,u=this.items.get(n),m=n.value,v=n.selectionStart,b=n.selectionEnd;let x=m;if(u.isEager()){const g=u.masked(m),O=u.unmasked(m);O===""&&"data"in s&&s.data!=null?x=s.data:O!==u.unmasked(g)&&(x=O)}if(this.setMaskedValue(n,x),"inputType"in s&&(s.inputType.startsWith("delete")||v!=null&&v<m.length))try{n.setSelectionRange(v,b)}catch{}}),this.options=e,typeof a=="string"?this.init(Array.from(document.querySelectorAll(a)),this.getMaskOpts(e)):this.init("length"in a?Array.from(a):[a],this.getMaskOpts(e))}destroy(){for(const a of this.items.keys())a.removeEventListener("input",this.inputEvent),a.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(a,e){const s=this.items.get(a),n=new te(se(a,this.getMaskOpts(e)));return JSON.stringify(s.opts)!==JSON.stringify(n.opts)}needUpdateValue(a){const e=a.dataset.maskaValue;return e==null&&a.value!==""||e!=null&&e!==a.value}getMaskOpts(a){const{onMaska:e,preProcess:s,postProcess:n,...u}=a;return u}init(a,e){for(const s of a){const n=new te(se(s,e));this.items.set(s,n),s.value!==""&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(a,e){const s=this.items.get(a);this.options.preProcess!=null&&(e=this.options.preProcess(e));const n=s.masked(e),u=s.unmasked(s.isEager()?n:e),m=s.completed(e),v={masked:n,unmasked:u,completed:m};e=n,this.options.postProcess!=null&&(e=this.options.postProcess(e)),a.value=e,a.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(b=>b(v)):this.options.onMaska(v)),a.dispatchEvent(new CustomEvent("maska",{detail:v})),a.dispatchEvent(new CustomEvent("input",{detail:v}))}}const J=new WeakMap,Se=l=>{setTimeout(()=>{var a;((a=J.get(l))==null?void 0:a.needUpdateValue(l))===!0&&l.dispatchEvent(new CustomEvent("input"))})},ne=(l,a)=>{const e=l instanceof HTMLInputElement?l:l.querySelector("input"),s={...a.arg};if(e==null)return;Se(e);const n=J.get(e);if(n!=null){if(!n.needUpdateOptions(e,s))return;n.destroy()}if(a.value!=null){const u=a.value,m=v=>{u.masked=v.masked,u.unmasked=v.unmasked,u.completed=v.completed};s.onMaska=s.onMaska==null?m:Array.isArray(s.onMaska)?[...s.onMaska,m]:[s.onMaska,m]}J.set(e,new Re(e,s))};const Be={class:"modal fade",id:"modal-form",tabindex:"-1",role:"dialog","aria-labelledby":"modal-form","aria-hidden":"true"},Ue={class:"modal-dialog modal-dialog-centered modal-dialog-popin modal-lg",role:"document"},je={class:"modal-content"},Fe={class:"modal-header"},Pe={class:"modal-title"},Te={class:"modal-body"},Ne={key:0,class:"form-label"},Le=["onUpdate:modelValue","type","placeholder","disabled","data-maska","onBlur"],Ie=["onUpdate:modelValue","rows","placeholder","disabled","onBlur"],We=["onUpdate:modelValue","disabled","onBlur"],qe=["value"],De={key:7,class:"form-check"},Je=["onUpdate:modelValue","id","onChange"],ze=["for"],He={key:8,class:"invalid-feedback d-block"},Ze={directives:{maska:ne}},Ke=Object.assign(Ze,{__name:"BaseModalForm",props:{modelValue:{type:Object,default:()=>({})},fields:{type:Array,required:!0},api:{type:Object,required:!0},idField:{type:String,default:"id"},title:{type:String,default:"Editar / Criar"},extraPayload:{type:Object,default:()=>({})}},emits:["update:modelValue","saved","close","create","edit"],setup(l,{expose:a,emit:e}){const s=l;Q(!1);const n=oe({}),u=(o=!1)=>{var r;s.fields.forEach(c=>{var i;if(c.skipInit)return;const t=c.name;!o&&((i=s.modelValue)==null?void 0:i.hasOwnProperty(t))?n[t]=s.modelValue[t]:c.hasOwnProperty("default")?n[t]=typeof c.default=="function"?c.default():c.default:n[t]=c.multiple?[]:c.type==="checkbox"?!1:null}),!o&&((r=s.modelValue)==null?void 0:r[s.idField])?n[s.idField]=s.modelValue[s.idField]:n[s.idField]=null};u(),re(()=>s.modelValue,o=>{u(),o&&Object.keys(o).forEach(r=>{n.hasOwnProperty(r)&&(n[r]=o[r])})},{deep:!0,immediate:!0});const m={required:ve,email:be,minLength:_e,maxLength:Me,minValue:Ee,maxValue:Ve},v={required:"Campo obrigat\xF3rio",email:"E-mail inv\xE1lido",minLength:o=>`M\xEDnimo de ${o.$params.min} caracteres`,maxLength:o=>`M\xE1ximo de ${o.$params.max} caracteres`,minValue:o=>`O valor m\xEDnimo \xE9 ${o.$params.min}`,maxValue:o=>`O valor m\xE1ximo \xE9 ${o.$params.max}`},b=(o,r,c)=>{if(o)return L.withMessage(o,r);if(v[c]){const t=v[c];return typeof t=="function"?L.withMessage(i=>t(i),r):L.withMessage(t,r)}return L.withMessage("Campo inv\xE1lido",r)};function x(o){if(!o)return null;if(o.includes(":")){const[c,t]=o.split(":"),i=t.split(",").map(d=>{const f=Number(d.trim());return isNaN(f)?d.trim():f});return{name:c.trim(),args:i}}const r=o.match(/^(\w+)\((.*)\)$/);if(r){const c=r[1],t=r[2].split(",").map(i=>{const d=Number(i.trim());return isNaN(d)?i.trim():d});return{name:c,args:t}}return{name:o.trim(),args:[]}}function g(o){var t;const r={};if(!o.rules)return r;const c=o.messages||{};if(Array.isArray(o.rules))return o.rules.forEach((i,d)=>{var f;if(typeof i=="function")r[`r${d}`]=i;else if(typeof i=="string"){const k=x(i);if(!k)return;const p=m[k.name];if(!p)return;const _=(f=k.args)!=null&&f.length?p(...k.args):p;r[k.name]=b(c[k.name],_,k.name)}else i&&typeof i=="object"&&Object.entries(i).forEach(([k,p])=>{const _=m[k];if(!_)return;let R,B=c[k];if(typeof p=="object"&&p!==null){const U=Array.isArray(p.value)?p.value:p.value!==void 0?[p.value]:p.args||[];B=p.message||B,R=U.length?_(...U):_}else p===!0||p===void 0?R=_:R=_(p);r[k]=b(B,R,k)})}),r;if(typeof o.rules=="object")return Object.entries(o.rules).forEach(([i,d])=>{const f=m[i];if(!f)return;let k,p=c[i];if(typeof d=="object"&&d!==null){const _=Array.isArray(d.value)?d.value:d.value!==void 0?[d.value]:d.args||[];p=d.message||p,k=_.length?f(..._):f}else d===!0||d===void 0?k=f:k=f(d);r[i]=b(p,k,i)}),r;if(typeof o.rules=="string"){const i=x(o.rules);if(i){const d=m[i.name];if(d){const f=(t=i.args)!=null&&t.length?d(...i.args):d;r[i.name]=b(c[i.name],f,i.name)}}}return r}const O=le(()=>{const o={};return s.fields.forEach(r=>{o[r.name]=g(r)}),o}),h=ye(O,n),S=Q(null),I=async()=>{var t;if(S.value.loaderOn(),h.value.$touch(),!await h.value.$validate()){S.value.loaderOff();return}let r;const c={...n,...s.extraPayload};n[s.idField]?r=await s.api.update(n[s.idField],c):r=await s.api.save(c),Ae(r,"Altera\xE7\xF5es salvas com sucesso"),r!=null&&r.success&&(e("saved",(t=r.data)!=null?t:n),C()),S.value.loaderOff()};a({openModal:(o=!1)=>{u(o),h.value.$reset(),new bootstrap.Modal(document.getElementById("modal-form")).show(),e(o?"create":"edit",n)}});const C=()=>{u(!1),h.value.$reset();const o=document.getElementById("modal-form"),r=bootstrap.Modal.getInstance(o);r&&r.hide(),e("close")};return(o,r)=>{const c=ie("VAsyncSelect");return M(),w(W,null,[ue($e,{ref_key:"loader",ref:S},null,512),V("div",Be,[V("div",Ue,[V("div",je,[V("div",Fe,[V("h5",Pe,j(n[s.idField]?"Editar":"Criar"),1),V("button",{type:"button",class:"btn-close",onClick:C})]),V("div",Te,[(M(!0),w(W,null,X(l.fields,t=>{var i,d,f,k,p,_,R,B,U,z,H,Z,K,G;return M(),w("div",{key:t.name,class:"mb-3"},[t.type!=="checkbox"?(M(),w("label",Ne,j(t.label),1)):T("",!0),t.slot?ce(o.$slots,t.slot,{key:1,field:t,model:n,v:E(h)},void 0,!0):t.component?(M(),Y(me(t.component),de({key:2,modelValue:n[t.name],"onUpdate:modelValue":y=>n[t.name]=y},t.props,{class:[t.class,{"is-invalid":((d=(i=E(h))==null?void 0:i[t.name])==null?void 0:d.$error)&&t.addInvalidClass!==!1}],onBlur:y=>{var $,A;return(A=($=E(h))==null?void 0:$[t.name])==null?void 0:A.$touch()}}),null,16,["modelValue","onUpdate:modelValue","class","onBlur"])):["text","email","number","password","date","tel"].includes(t.type)?N((M(),w("input",{key:3,"onUpdate:modelValue":y=>n[t.name]=y,type:t.type,class:q(["form-control",{"is-invalid":(k=(f=E(h))==null?void 0:f[t.name])==null?void 0:k.$errors.length}]),placeholder:t.placeholder,disabled:t.disabled,"data-maska":t.mask,onBlur:(_=(p=E(h))==null?void 0:p[t.name])==null?void 0:_.$touch},null,42,Le)),[[pe,n[t.name]],[E(ne)]]):t.type==="textarea"?N((M(),w("textarea",{key:4,"onUpdate:modelValue":y=>n[t.name]=y,class:q(["form-control",{"is-invalid":(B=(R=E(h))==null?void 0:R[t.name])==null?void 0:B.$error}]),rows:t.rows||3,placeholder:t.placeholder,disabled:t.disabled,onBlur:y=>{var $,A;return(A=($=E(h))==null?void 0:$[t.name])==null?void 0:A.$touch()}},null,42,Ie)),[[he,n[t.name]]]):t.type==="select"?N((M(),w("select",{key:5,"onUpdate:modelValue":y=>n[t.name]=y,class:q(["form-select",{"is-invalid":(z=(U=E(h))==null?void 0:U[t.name])==null?void 0:z.$error}]),disabled:t.disabled,onBlur:y=>{var $,A;return(A=($=E(h))==null?void 0:$[t.name])==null?void 0:A.$touch()}},[(M(!0),w(W,null,X(t.options||[],y=>(M(),w("option",{key:y.value,value:y.value},j(y.label),9,qe))),128))],42,We)),[[ke,n[t.name]]]):T("",!0),t.type==="async-select"?(M(),Y(c,{key:6,entity:t.entity,modelValue:n[t.name],"onUpdate:modelValue":y=>n[t.name]=y,"pre-filled-value":n[t.name]},null,8,["entity","modelValue","onUpdate:modelValue","pre-filled-value"])):t.type==="checkbox"?(M(),w("div",De,[N(V("input",{"onUpdate:modelValue":y=>n[t.name]=y,type:"checkbox",class:"form-check-input",id:t.name,onChange:y=>{var $,A;return(A=($=E(h))==null?void 0:$[t.name])==null?void 0:A.$touch()}},null,40,Je),[[ge,n[t.name]]]),V("label",{class:"form-check-label",for:t.name},j(t.label),9,ze)])):T("",!0),(Z=(H=E(h))==null?void 0:H[t.name])!=null&&Z.$errors.length?(M(),w("div",He,j(((G=(K=E(h)[t.name].$errors)==null?void 0:K[0])==null?void 0:G.$message)||t.errorMessage||"Campo inv\xE1lido"),1)):T("",!0)])}),128))]),V("div",{class:"modal-footer"},[V("button",{type:"button",class:"btn btn-danger btn-lg",onClick:C},"Cancelar"),V("button",{type:"button",class:"btn btn-success btn-lg",onClick:I},"Salvar")])])])])],64)}}}),et=fe(Ke,[["__scopeId","data-v-65028289"]]);export{et as B};
