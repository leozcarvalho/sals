import{B as O,u as j,A as U,r as h,q as D,o as z,a as J,b as o,e as i,g as V,w as P,d as e,D as _,J as y,n as f,m as d,h as m,E as B,F as A,f as F,t as x,G as H}from"./index.89030e27.js";import{r as b,d as Q,b as w,u as W}from"./index.09277535.js";import{h as X}from"./toast.f384bd24.js";import{_ as N}from"./NumericInput.cadac889.js";const Y={class:"content"},Z={class:"mb-3"},ee=e("label",{class:"form-label"},"Nome",-1),ae={key:0,class:"invalid-feedback"},se={class:"mb-3"},le=e("label",{class:"form-label"},"Descri\xE7\xE3o",-1),te={key:0,class:"invalid-feedback"},oe={class:"mb-3"},ie=e("label",{class:"form-label"},"Status",-1),ne=e("option",{value:!0},"Ativo",-1),re=e("option",{value:!1},"Inativo",-1),de=[ne,re],ce={key:0,class:"invalid-feedback"},ue={class:"row mb-3"},me={class:"col"},_e=e("label",{class:"form-label"},"Dia Inicial",-1),ve={class:"col"},pe=e("label",{class:"form-label"},"Dia Final",-1),he={key:0,class:"row mb-3"},fe=e("div",{class:"col-1"},[e("strong",null,"#")],-1),be=e("div",{class:"col-1"},[e("strong",null,"Dia")],-1),ge=e("div",{class:"col-6"},[e("strong",null,"F\xF3rmula")],-1),ye=e("div",{class:"col-2"},[e("strong",null,"Massa da f\xF3rmula (Kg)")],-1),$e=e("div",{class:"col-2"},[e("strong",null,"Peso do animal (kg)")],-1),ke=[fe,be,ge,ye,$e],Ve={class:"col-1"},we={class:"badge bg-secondary"},Ce={class:"col-1"},Ue=["onUpdate:modelValue"],De={class:"col-6"},Be=["onUpdate:modelValue"],Ae=e("option",{value:""},"Selecione uma f\xF3rmula",-1),Fe=["value"],xe={key:0,class:"invalid-feedback"},Ne={class:"col-2"},Se={class:"input-group"},Me=e("span",{class:"input-group-text"},"Kg",-1),qe={key:0,class:"invalid-feedback d-block"},Ee={key:1,class:"invalid-feedback d-block"},Ie={class:"col-2"},Le={class:"input-group"},Re=e("span",{class:"input-group-text"},"kg",-1),Te={key:0,class:"invalid-feedback d-block"},Ge=["disabled"],Ke={key:0,class:"spinner-border spinner-border-sm me-2"},He={__name:"FeedingCurveForm",setup(Oe){const S=O(),M=j(),k=new U("/feeding-curves"),q=new U("/formulas"),g=h(null),C=h([]),v=h(null),p=h(null),a=D({name:"",description:"",is_active:!0,details:[]}),E=async()=>{const n=await k.get(g.value);Object.assign(a,n.data),a.details&&a.details.length>0&&(v.value=a.details[0].age_day,p.value=a.details[a.details.length-1].age_day)},I=async()=>{const n=await q.getList();C.value=n.data.items.map(r=>({label:r.name,value:r.id}))||[]};z(async()=>{g.value=M.params.id,g.value&&await E(),await I()});const L=D({name:{required:b},description:{required:b},is_active:{required:b},details:{$each:Q.forEach({day:{required:b,minValue:w(1)},formula_id:{required:b},formula_mass_per_animal:{required:b,minValue:w(1)},animal_weight:{minValue:w(0)}})}}),l=W(L,a),R=()=>{if(!(!v.value||!p.value||p.value<v.value)){a.details=[];for(let n=v.value;n<=p.value;n++)a.details.push({age_day:n,formula_id:null,formula_mass_per_animal:0,animal_weight:0,is_active:!0})}},T=n=>{X(n,"Curva salva com sucesso"),n.success&&S.push({name:"feeding-curves"})},t=h(!1),$=h(!1),G=async()=>{if(l.value.$touch(),t.value=!0,!l.value.$invalid){$.value=!0;try{const n=g.value?await k.update(g.value,a):await k.save(a);T(n)}finally{$.value=!1}}};return(n,r)=>{const K=J("BaseBlock");return o(),i("div",Y,[V(K,{title:"Curva de Alimenta\xE7\xE3o"},{default:P(()=>[e("div",Z,[ee,_(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>a.name=s),type:"text",class:f(["form-control",{"is-invalid":d(l).name.$error&&t.value}])},null,2),[[y,a.name]]),d(l).name.$error&&t.value?(o(),i("div",ae,"Campo obrigat\xF3rio")):m("",!0)]),e("div",se,[le,_(e("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>a.description=s),type:"text",class:f(["form-control",{"is-invalid":d(l).description.$error&&t.value}])},null,2),[[y,a.description]]),d(l).description.$error&&t.value?(o(),i("div",te,"Campo obrigat\xF3rio")):m("",!0)]),e("div",oe,[ie,_(e("select",{"onUpdate:modelValue":r[2]||(r[2]=s=>a.is_active=s),class:f(["form-select",{"is-invalid":d(l).is_active.$error&&t.value}])},de,2),[[B,a.is_active]]),d(l).is_active.$error&&t.value?(o(),i("div",ce," Campo obrigat\xF3rio ")):m("",!0)]),e("div",ue,[e("div",me,[_e,_(e("input",{"onUpdate:modelValue":r[3]||(r[3]=s=>v.value=s),type:"number",min:"1",class:"form-control"},null,512),[[y,v.value]])]),e("div",ve,[pe,_(e("input",{"onUpdate:modelValue":r[4]||(r[4]=s=>p.value=s),type:"number",min:"1",class:"form-control"},null,512),[[y,p.value]])]),e("div",{class:"col-auto d-flex align-items-end"},[e("button",{type:"button",class:"btn btn-success",onClick:R}," Gerar Linhas ")])]),a.details.length>0?(o(),i("div",he,ke)):m("",!0),(o(!0),i(A,null,F(a.details,(s,u)=>(o(),i("div",{key:u,class:"row g-2 align-items-start mb-2"},[e("div",Ve,[e("span",we,x(u+1),1)]),e("div",Ce,[_(e("input",{"onUpdate:modelValue":c=>s.age_day=c,type:"text",class:"form-control",disabled:""},null,8,Ue),[[y,s.age_day]])]),e("div",De,[_(e("select",{"onUpdate:modelValue":c=>s.formula_id=c,class:f(["form-select",{"is-invalid":d(l).details.$each.$response.$data[u].formula_id.$error&&t.value}])},[Ae,(o(!0),i(A,null,F(C.value,c=>(o(),i("option",{key:c.value,value:c.value},x(c.label),9,Fe))),128))],10,Be),[[B,s.formula_id]]),d(l).details.$each.$response.$data[u].formula_id.$error&&t.value?(o(),i("div",xe," Campo obrigat\xF3rio ")):m("",!0)]),e("div",Ne,[e("div",Se,[V(N,{modelValue:s.formula_mass_per_animal,"onUpdate:modelValue":c=>s.formula_mass_per_animal=c,type:"decimal",min:0,max:100,step:.01,class:f({"is-invalid":d(l).details.$each.$response.$data[u].formula_mass_per_animal.$error&&t.value})},null,8,["modelValue","onUpdate:modelValue","class"]),Me]),!d(l).details.$each.$response.$data[u].formula_mass_per_animal.required&&t.value?(o(),i("div",qe," Campo obrigat\xF3rio ")):!d(l).details.$each.$response.$data[u].formula_mass_per_animal.minValue&&t.value?(o(),i("div",Ee," Valor m\xEDnimo: 1 ")):m("",!0)]),e("div",Ie,[e("div",Le,[V(N,{modelValue:s.animal_weight,"onUpdate:modelValue":c=>s.animal_weight=c,type:"decimal",min:0,max:100,step:.01,class:f({"is-invalid":d(l).details.$each.$response.$data[u].animal_weight.$error&&t.value})},null,8,["modelValue","onUpdate:modelValue","class"]),Re]),d(l).details.$each.$response.$data[u].animal_weight.$error&&t.value?(o(),i("div",Te," Valor inv\xE1lido ")):m("",!0)])]))),128)),e("button",{onClick:G,class:"btn btn-primary mb-4 btn-lg",disabled:$.value},[$.value?(o(),i("span",Ke)):m("",!0),H(" Salvar ")],8,Ge)]),_:1})])}}};export{He as default};
