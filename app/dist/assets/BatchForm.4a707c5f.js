import{A as S,B as be,u as pe,r as f,q as L,o as fe,s as ye,a as J,b as o,e as i,g as F,d as e,w as ge,D as c,J as N,n as w,m as d,h as u,E as y,F as b,f as g,t as p,G as P}from"./index.25e36820.js";import{r as C,b as I,d as ke,u as H,f as W}from"./index.8fb258bd.js";import{h as X}from"./toast.4464608c.js";import{_ as we}from"./Loader.4eef347d.js";import{f as Ce}from"./formatters.fd94289a.js";class $e extends S{constructor(){super("/batches")}async execMoviment(R,E){try{return(await this.api.post(`${this.path}/${R}/moviment`,E)).data}catch($){return $.response}}}const Ae={class:"content"},Ve={class:"row"},Ne={class:"mb-3 col-6"},Se=e("label",{class:"form-label"},"Nome",-1),De=["disabled"],Me={key:0,class:"invalid-feedback"},Ue={class:"mb-3 col-6"},qe=e("label",{class:"form-label"},"Status",-1),Re=e("option",{value:!0},"Ativo",-1),Ee=e("option",{value:!1},"Inativo",-1),Be=[Re,Ee],Te={class:"mb-3"},xe=e("label",{class:"form-label"},"Descri\xE7\xE3o",-1),Oe=["disabled"],Le={class:"mb-3 col-6"},Fe=e("label",{class:"form-label"},"Galp\xE3o",-1),Ie=["disabled"],Ke=e("option",{value:""},"Selecione",-1),je=["value"],Ge={key:0,class:"invalid-feedback"},Qe={class:"mb-3 col-6"},ze=e("label",{class:"form-label"},"Sala",-1),Je={key:0},Pe=["value"],He=["disabled"],We=e("option",{value:""},"Selecione",-1),Xe=["value"],Ye={key:2,class:"invalid-feedback"},Ze={class:"mb-3 col-6"},es=e("label",{class:"form-label"},"Curva de Alimenta\xE7\xE3o",-1),ss=e("option",{value:""},"Selecione",-1),ts=["value"],os={key:0,class:"invalid-feedback"},is={class:"mb-3 col-6"},ls=e("label",{class:"form-label"},"Dia Inicial",-1),as=["disabled"],ns=e("option",{value:""},"Selecione",-1),ds=["value"],cs={key:0,class:"invalid-feedback"},us={class:"d-flex justify-content-between align-items-center mb-2"},rs=e("h5",{class:"m-0"},"Movimentos",-1),_s={key:0,class:"mb-3"},vs=e("div",{class:"row mb-3"},[e("div",{class:"col-2"},[e("strong",null,"Tipo Movimento")]),e("div",{class:"col-2"},[e("strong",null,"Baia Origem")]),e("div",{class:"col-2"},[e("strong",null,"Baia Destino")]),e("div",{class:"col-1"},[e("strong",null,"Qnt")]),e("div",{class:"col-2"},[e("strong",null,"Descri\xE7\xE3o")]),e("div",{class:"col-3"},[e("strong",null,"Data")])],-1),ms={class:"col-2"},hs=["onUpdate:modelValue","disabled"],bs=e("option",{value:""},"Selecione o tipo",-1),ps=["value"],fs={class:"col-2"},ys=["onUpdate:modelValue","disabled"],gs=e("option",{value:""},"Origem",-1),ks=["value"],ws={class:"col-2"},Cs=["onUpdate:modelValue","disabled"],$s=e("option",{value:""},"Destino",-1),As=["value"],Vs={class:"col-1"},Ns=["onUpdate:modelValue","disabled"],Ss={class:"col-2"},Ds=["onUpdate:modelValue","disabled"],Ms={key:0,class:"col-2 col-md-3"},Us=["value"],qs=["disabled"],Rs={key:0,class:"spinner-border spinner-border-sm me-2"},Es={key:0,class:"modal fade show d-block",tabindex:"-1"},Bs={class:"modal-dialog modal-dialog-centered"},Ts={class:"modal-content"},xs={class:"modal-header"},Os=e("h5",{class:"modal-title"},"Novo Movimento",-1),Ls={class:"modal-body"},Fs={class:"mb-3"},Is=e("label",null,"Tipo de Movimento",-1),Ks=e("option",{value:""},"Selecione",-1),js=["value"],Gs={key:0,class:"invalid-feedback"},Qs={key:0,class:"mb-3"},zs=e("label",null,"Baia Origem",-1),Js=e("option",{value:""},"Selecione",-1),Ps=["value"],Hs={key:0,class:"invalid-feedback"},Ws={key:1,class:"mb-3"},Xs=e("label",null,"Baia Destino",-1),Ys=e("option",{value:""},"Selecione",-1),Zs=["value"],et={key:0,class:"invalid-feedback"},st={class:"mb-3"},tt=e("label",null,"Quantidade",-1),ot={key:0,class:"invalid-feedback"},it={class:"mb-3"},lt=e("label",null,"Descri\xE7\xE3o (opcional)",-1),at={class:"modal-footer"},nt={key:1,class:"modal-backdrop fade show"},vt={__name:"BatchForm",setup(Y){const R=be(),E=pe(),$=new $e,Z=new S("/sheds"),ee=new S("/feeding-curves"),se=new S("/moviment-kinds"),te=new S("/room-stalls"),oe=new S("/shed-rooms"),r=f(null),K=f([]),j=f([]),B=f([]),T=f([]),D=f([]),l=L({name:"",description:"",initial_day:null,is_active:!0,feeding_curve_id:null,shed_id:null,shed_room_id:null,moviments:[],shed_room:{}}),x=async()=>{const a=await $.get(r.value);Object.assign(l,a.data),l.shed_id&&await G(l.shed_id),l.feeding_curve_id&&await Q(l.feeding_curve_id),l.shed_room_id&&await O(l.shed_room_id)},ie=async()=>{const a=await Z.getList();K.value=a.data.items.map(t=>({label:t.name,value:t.id,rooms:t.rooms}))||[]},G=async a=>{const t=await oe.getList({shed_id:a,is_in_batch:!1});j.value=t.data.items.map(m=>({label:m.name,value:m.id}))||[]},le=async()=>{const a=await ee.getList();B.value=a.data.items.map(t=>({label:t.name,value:t.id,details:t.details}))||[]},Q=async a=>{var m;const t=B.value.find(U=>U.value===a);t&&(T.value=((m=t.details)==null?void 0:m.map(U=>U.age_day))||[])},ae=async()=>{const a=await se.getList();D.value=a.data.items.map(t=>({label:t.code,value:t.id,kind:t.kind}))||[]},ne=async()=>{!l.shed_room_id||(await O(l.shed_room_id),r.value||de())},A=f([]),O=async a=>{if(!a)return;const t=await te.getList({shed_room_id:a});A.value=t.data.items.map(m=>({label:m.name,value:m.id,qnt:m.animals_quantity}))||[]},de=()=>{l.moviments=A.value.map(a=>{var t;return{moviment_kind_code:"ENTRADA_LOTE",moviment_kind_id:((t=D.value.find(m=>m.label==="ENTRADA_LOTE"))==null?void 0:t.value)||null,stall_origin_id:a.value,stall_destination_id:null,quantity:0,description:"",isNew:!0}})},_=L({moviment_kind_:{},stall_origin_id:null,stall_destination_id:null,quantity:null,description:""});fe(async()=>{r.value=E.params.id,await Promise.all([ie(),le(),ae(),O()]),r.value&&await x()});const ce=L({name:{required:C},description:{},is_active:{required:C},initial_day:{required:C,minValue:I(1)},feeding_curve_id:{required:C},shed_id:{required:C},shed_room_id:{required:C},moviments:{$each:ke.forEach({quantity:{required:C,minValue:I(0)}})}}),v=H(ce,l),h=f(!1),q=f(!1),ue=async a=>{X(a,"Lote salvo com sucesso"),a.success&&(r.value||(R.push({name:"batch-form",params:{id:a.data.id}}),r.value=a.data.id),await x())},re=async()=>{if(v.value.$touch(),h.value=!0,!v.value.$invalid){q.value=!0;try{const a=r.value?await $.update(r.value,l):await $.save(l);await ue(a)}finally{q.value=!1}}},_e=ye(()=>({moviment_kind_id:{required:C},stall_origin_id:{required:W(()=>["ENTRADA","TRANSFERENCIA"].includes(M.value))},stall_destination_id:{required:W(()=>["SAIDA","TRANSFERENCIA"].includes(M.value))},quantity:{required:C,minValue:I(1)}})),k=H(_e,_),V=f(!1),ve=()=>{Object.assign(_,{moviment_kind_id:null,stall_origin_id:null,stall_destination_id:null,quantity:null,description:""}),V.value=!0},M=f(null),me=()=>{const a=D.value.find(t=>t.value===_.moviment_kind_id);M.value=a?a.kind:null},he=async()=>{if(k.value.$touch(),k.value.$invalid)return;const a=await $.execMoviment(r.value,_);X(a,"Movimento registrado com sucesso"),a.success&&(V.value=!1,await x())};return(a,t)=>{const m=J("mdicon"),U=J("BaseBlock");return o(),i(b,null,[F(we,{ref:"loader"},null,512),e("div",Ae,[F(U,{title:"Lote"},{default:ge(()=>[e("div",Ve,[e("div",Ne,[Se,c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.name=s),type:"text",class:w(["form-control",{"is-invalid":d(v).name.$error&&h.value}]),disabled:r.value},null,10,De),[[N,l.name]]),d(v).name.$error&&h.value?(o(),i("div",Me," Campo obrigat\xF3rio ")):u("",!0)]),e("div",Ue,[qe,c(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.is_active=s),class:"form-select"},Be,512),[[y,l.is_active]])]),e("div",Te,[xe,c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.description=s),type:"text",class:"form-control",disabled:r.value},null,8,Oe),[[N,l.description]])]),e("div",Le,[Fe,c(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.shed_id=s),class:w(["form-select",{"is-invalid":d(v).shed_id.$error&&h.value}]),onChange:t[4]||(t[4]=s=>G(l.shed_id)),disabled:r.value},[Ke,(o(!0),i(b,null,g(K.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label),9,je))),128))],42,Ie),[[y,l.shed_id]]),d(v).shed_id.$error&&h.value?(o(),i("div",Ge," Campo obrigat\xF3rio ")):u("",!0)]),e("div",Qe,[ze,r.value?(o(),i("div",Je,[e("input",{value:l.shed_room.name,class:"form-control",disabled:""},null,8,Pe)])):c((o(),i("select",{key:1,"onUpdate:modelValue":t[5]||(t[5]=s=>l.shed_room_id=s),class:w(["form-select",{"is-invalid":d(v).shed_room_id.$error&&h.value}]),onChange:ne,disabled:r.value},[We,(o(!0),i(b,null,g(j.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label),9,Xe))),128))],42,He)),[[y,l.shed_room_id]]),d(v).shed_room_id.$error&&h.value?(o(),i("div",Ye," Campo obrigat\xF3rio ")):u("",!0)]),e("div",Ze,[es,c(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.feeding_curve_id=s),class:w(["form-select",{"is-invalid":d(v).feeding_curve_id.$error&&h.value}]),onChange:t[7]||(t[7]=s=>Q(l.feeding_curve_id))},[ss,(o(!0),i(b,null,g(B.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label),9,ts))),128))],34),[[y,l.feeding_curve_id]]),d(v).feeding_curve_id.$error&&h.value?(o(),i("div",os," Campo obrigat\xF3rio ")):u("",!0)]),e("div",is,[ls,c(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.initial_day=s),class:w(["form-select",{"is-invalid":d(v).initial_day.$error&&h.value}]),disabled:T.value.length===0},[ns,(o(!0),i(b,null,g(T.value,s=>(o(),i("option",{key:s,value:s}," Dia "+p(s),9,ds))),128))],10,as),[[y,l.initial_day]]),d(v).initial_day.$error&&h.value?(o(),i("div",cs," Selecione o dia inicial do lote ")):u("",!0)])]),e("div",null,[e("div",us,[rs,e("div",null,[r.value?(o(),i("button",{key:0,type:"button",class:"btn btn-success btn-sm",onClick:ve},[F(m,{name:"plus"}),P(" Novo Movimento ")])):u("",!0)])]),l.moviments.length>0?(o(),i("div",_s,[vs,(o(!0),i(b,null,g(l.moviments,(s,z)=>(o(),i("div",{key:z,class:"row g-2 align-items-start mb-2"},[e("div",ms,[c(e("select",{"onUpdate:modelValue":n=>s.moviment_kind_id=n,class:"form-select",disabled:!s.isNew},[bs,(o(!0),i(b,null,g(D.value,n=>(o(),i("option",{key:n.value,value:n.value},p(n.label),9,ps))),128))],8,hs),[[y,s.moviment_kind_id]])]),e("div",fs,[c(e("select",{"onUpdate:modelValue":n=>s.stall_origin_id=n,class:"form-select",disabled:!s.isNew},[gs,(o(!0),i(b,null,g(A.value,n=>(o(),i("option",{key:n.value,value:n.value},p(n.label),9,ks))),128))],8,ys),[[y,s.stall_origin_id]])]),e("div",ws,[c(e("select",{"onUpdate:modelValue":n=>s.stall_destination_id=n,class:"form-select",disabled:!s.isNew},[$s,(o(!0),i(b,null,g(A.value,n=>(o(),i("option",{key:n.value,value:n.value},p(n.label),9,As))),128))],8,Cs),[[y,s.stall_destination_id]])]),e("div",Vs,[c(e("input",{class:w([{"is-invalid":d(v).moviments.$each.$response.$data[z].quantity.$error&&h.value},"form-control"]),"onUpdate:modelValue":n=>s.quantity=n,type:"number",min:"1",disabled:!s.isNew},null,10,Ns),[[N,s.quantity,void 0,{number:!0}]])]),e("div",Ss,[c(e("input",{"onUpdate:modelValue":n=>s.description=n,rows:"2",class:"form-control",placeholder:"Descri\xE7\xE3o opcional",disabled:!s.isNew},null,8,Ds),[[N,s.description]])]),s.id?(o(),i("div",Ms,[e("input",{value:d(Ce)(s.created_at),class:"form-control",disabled:""},null,8,Us)])):u("",!0)]))),128))])):u("",!0)]),e("button",{onClick:re,class:"btn btn-primary mb-4 btn-lg",disabled:q.value},[q.value?(o(),i("span",Rs)):u("",!0),P(" Salvar ")],8,qs),V.value?(o(),i("div",Es,[e("div",Bs,[e("div",Ts,[e("div",xs,[Os,e("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=s=>V.value=!1)})]),e("div",Ls,[e("div",Fs,[Is,c(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>_.moviment_kind_id=s),class:w(["form-select",{"is-invalid":d(k).moviment_kind_id.$error}]),onChange:me},[Ks,(o(!0),i(b,null,g(D.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label),9,js))),128))],34),[[y,_.moviment_kind_id]]),d(k).moviment_kind_id.$error?(o(),i("div",Gs," Campo obrigat\xF3rio ")):u("",!0)]),["ENTRADA","TRANSFERENCIA"].includes(M.value)?(o(),i("div",Qs,[zs,c(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>_.stall_origin_id=s),class:w(["form-select",{"is-invalid":d(k).stall_origin_id.$error}])},[Js,(o(!0),i(b,null,g(A.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label)+" ("+p(s.qnt)+" animais) ",9,Ps))),128))],2),[[y,_.stall_origin_id]]),d(k).stall_origin_id.$error?(o(),i("div",Hs," Campo obrigat\xF3rio ")):u("",!0)])):u("",!0),["SAIDA","TRANSFERENCIA"].includes(M.value)?(o(),i("div",Ws,[Xs,c(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>_.stall_destination_id=s),class:w(["form-select",{"is-invalid":d(k).stall_destination_id.$error}])},[Ys,(o(!0),i(b,null,g(A.value,s=>(o(),i("option",{key:s.value,value:s.value},p(s.label)+" ("+p(s.qnt)+" animais) ",9,Zs))),128))],2),[[y,_.stall_destination_id]]),d(k).stall_destination_id.$error?(o(),i("div",et," Campo obrigat\xF3rio ")):u("",!0)])):u("",!0),e("div",st,[tt,c(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>_.quantity=s),type:"number",min:"1",class:w(["form-control",{"is-invalid":d(k).quantity.$error}])},null,2),[[N,_.quantity,void 0,{number:!0}]]),d(k).quantity.$error?(o(),i("div",ot," Campo obrigat\xF3rio ")):u("",!0)]),e("div",it,[lt,c(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=s=>_.description=s),class:"form-control"},null,512),[[N,_.description]])])]),e("div",at,[e("button",{class:"btn btn-secondary",onClick:t[15]||(t[15]=s=>V.value=!1)},"Cancelar"),e("button",{class:"btn btn-success",onClick:he},"Salvar Movimento")])])])])):u("",!0),V.value?(o(),i("div",nt)):u("",!0)]),_:1})])],64)}}};export{vt as default};
