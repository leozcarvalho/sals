import{B as I,u as L,A as C,r as g,q as U,o as O,a as B,b as r,e as n,g as $,w as j,d as e,D as m,J as h,n as _,m as i,h as d,E as A,F,f as x,t as z}from"./index.0a935b94.js";import{r as p,b as k,c as D,d as J,u as G}from"./index.7ebf2a24.js";import{h as H}from"./toast.cd5fee6e.js";const K={class:"content"},Q={class:"mb-3"},W=e("label",{class:"form-label"},"Nome",-1),X={key:0,class:"invalid-feedback"},Y={class:"mb-3"},Z=e("label",{class:"form-label"},"Descri\xE7\xE3o",-1),ee={key:0,class:"invalid-feedback"},te={class:"mb-3"},se=e("label",{class:"form-label"},"% \xC1gua",-1),oe={key:0,class:"invalid-feedback"},ae={class:"mb-3"},le=e("label",{class:"form-label"},"Tempo de Agita\xE7\xE3o (segundos)",-1),ie={key:0,class:"invalid-feedback"},re={class:"mb-3"},ne=e("label",{class:"form-label"},"Status",-1),ce=e("option",{value:!0},"Ativo",-1),de=e("option",{value:!1},"Inativo",-1),ue=[ce,de],me={key:0,class:"invalid-feedback"},_e={class:"flex"},pe=e("label",{class:"form-label me-3"},"Detalhes",-1),ve={key:0,class:"row mb-3"},be=e("div",{class:"col-6"},[e("strong",null,"Produto")],-1),he=e("div",{class:"col-4"},[e("strong",null,"% Produto (sem umidade)")],-1),fe=e("div",{class:"col-2"},[e("strong")],-1),ge=[be,he,fe],$e={class:"col-6"},ke=["onUpdate:modelValue"],we=e("option",{value:""},"Selecione um produto",-1),ye=["value"],Ve={key:0,class:"invalid-feedback"},Ce={class:"col-4"},Ue=["onUpdate:modelValue"],Be={key:0,class:"invalid-feedback"},Ae={class:"col-auto d-flex align-items-start"},Fe=["onClick"],Pe={__name:"FormulaForm",setup(xe){const S=I(),N=L(),f=new C("/formulas"),P=new C("/products"),b=g(null),w=g([]),t=U({name:"",description:"",water_percentage:null,stirring_time:null,is_active:!0,details:[]}),E=async()=>{const u=await f.get(b.value);Object.assign(t,u.data)},M=async()=>{const u=await P.getList();w.value=u.data.items.map(a=>({label:a.name,value:a.id}))||[]};O(async()=>{b.value=N.params.id,b.value&&await E(),await M()});const R=U({name:{required:p},description:{required:p},water_percentage:{required:p,minValue:k(0),maxValue:D(100)},stirring_time:{required:p,minValue:k(1)},is_active:{required:p},details:{$each:J.forEach({product_id:{required:p},product_percentage_without_moisture:{required:p,minValue:k(0),maxValue:D(100)}})}}),s=G(R,t),y=u=>{H(u,"F\xF3rmula salva com sucesso"),u.success&&S.push({name:"formulas"})},o=g(!1),T=async()=>{s.value.$touch(),o.value=!0,!s.value.$invalid&&(b.value?y(await f.update(b.value,t)):y(await f.save(t)))};return(u,a)=>{const V=B("mdicon"),q=B("BaseBlock");return r(),n("div",K,[$(q,{title:"F\xF3rmula"},{default:j(()=>[e("div",Q,[W,m(e("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>t.name=l),type:"text",class:_(["form-control",{"is-invalid":i(s).name.$error&&o.value}])},null,2),[[h,t.name]]),i(s).name.$error&&o.value?(r(),n("div",X,"Campo obrigat\xF3rio")):d("",!0)]),e("div",Y,[Z,m(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>t.description=l),type:"text",class:_(["form-control",{"is-invalid":i(s).description.$error&&o.value}])},null,2),[[h,t.description]]),i(s).description.$error&&o.value?(r(),n("div",ee,"Campo obrigat\xF3rio")):d("",!0)]),e("div",te,[se,m(e("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>t.water_percentage=l),type:"number",class:_(["form-control",{"is-invalid":i(s).water_percentage.$error&&o.value}])},null,2),[[h,t.water_percentage]]),i(s).water_percentage.$error&&o.value?(r(),n("div",oe," Campo obrigat\xF3rio (0 \u2264 valor \u2264 100) ")):d("",!0)]),e("div",ae,[le,m(e("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>t.stirring_time=l),type:"number",class:_(["form-control",{"is-invalid":i(s).stirring_time.$error&&o.value}])},null,2),[[h,t.stirring_time]]),i(s).stirring_time.$error&&o.value?(r(),n("div",ie," Campo obrigat\xF3rio (\u2265 1) ")):d("",!0)]),e("div",re,[ne,m(e("select",{"onUpdate:modelValue":a[4]||(a[4]=l=>t.is_active=l),class:_(["form-select",{"is-invalid":i(s).is_active.$error&&o.value}])},ue,2),[[A,t.is_active]]),i(s).is_active.$error&&o.value?(r(),n("div",me," Campo obrigat\xF3rio ")):d("",!0)]),e("div",_e,[pe,e("button",{type:"button",class:"btn btn-lg btn-success mb-2",onClick:a[5]||(a[5]=l=>t.details.push({product_id:null,product_percentage_without_moisture:null}))},[$(V,{name:"plus"})])]),t.details.length>0?(r(),n("div",ve,ge)):d("",!0),(r(!0),n(F,null,x(t.details,(l,v)=>(r(),n("div",{key:v,class:"row g-2 align-items-start mb-2"},[e("div",$e,[m(e("select",{"onUpdate:modelValue":c=>l.product_id=c,class:_(["form-select",{"is-invalid":i(s).details.$each.$response.$data[v].product_id.$error&&o.value}])},[we,(r(!0),n(F,null,x(w.value,c=>(r(),n("option",{key:c.value,value:c.value},z(c.label),9,ye))),128))],10,ke),[[A,l.product_id]]),i(s).details.$each.$response.$data[v].product_id.$error&&o.value?(r(),n("div",Ve," Campo obrigat\xF3rio ")):d("",!0)]),e("div",Ce,[m(e("input",{"onUpdate:modelValue":c=>l.product_percentage_without_moisture=c,type:"number",step:"0.01",class:_(["form-control",{"is-invalid":i(s).details.$each.$response.$data[v].product_percentage_without_moisture.$error&&o.value}]),placeholder:"% Produto"},null,10,Ue),[[h,l.product_percentage_without_moisture]]),i(s).details.$each.$response.$data[v].product_percentage_without_moisture.$error&&o.value?(r(),n("div",Be," Campo obrigat\xF3rio (0 \u2264 valor \u2264 100) ")):d("",!0)]),e("div",Ae,[e("button",{type:"button",class:"btn btn-lg btn-danger",onClick:c=>t.details.splice(v,1)},[$(V,{name:"close"})],8,Fe)])]))),128)),e("button",{onClick:T,class:"btn btn-primary mb-4 btn-lg"},"Salvar")]),_:1})])}}};export{Pe as default};
