import{B as K,u as O,A as C,r as f,q as U,o as P,a as j,b as i,e as n,g as z,w as J,d as e,D as _,J as v,n as b,m as o,h as m,E as D,F as B,f as A,t as F,G as H}from"./index.4aae8c21.js";import{r as g,d as Q,b as V,u as W}from"./index.607cd4df.js";import{h as X}from"./toast.a6367562.js";import{U as M}from"./maska.f37bce9a.js";const Y={class:"content"},Z={class:"mb-3"},ee=e("label",{class:"form-label"},"Nome",-1),ae={key:0,class:"invalid-feedback"},se={class:"mb-3"},te=e("label",{class:"form-label"},"Descri\xE7\xE3o",-1),oe={key:0,class:"invalid-feedback"},le={class:"mb-3"},ie=e("label",{class:"form-label"},"Status",-1),ne=e("option",{value:!0},"Ativo",-1),re=e("option",{value:!1},"Inativo",-1),de=[ne,re],ce={key:0,class:"invalid-feedback"},ue={class:"row mb-3"},_e={class:"col"},me=e("label",{class:"form-label"},"Dia Inicial",-1),ve={class:"col"},pe=e("label",{class:"form-label"},"Dia Final",-1),he={key:0,class:"row mb-3"},fe=e("div",{class:"col-1"},[e("strong",null,"#")],-1),be=e("div",{class:"col-1"},[e("strong",null,"Dia")],-1),ge=e("div",{class:"col-6"},[e("strong",null,"F\xF3rmula")],-1),ye=e("div",{class:"col-2"},[e("strong",null,"Massa da f\xF3rmula (Kg)")],-1),$e=e("div",{class:"col-2"},[e("strong",null,"Peso do animal (kg)")],-1),ke=[fe,be,ge,ye,$e],Ve={class:"col-1"},we={class:"badge bg-secondary"},Ce={class:"col-1"},Ue=["onUpdate:modelValue"],De={class:"col-6"},Be=["onUpdate:modelValue"],Ae=e("option",{value:""},"Selecione uma f\xF3rmula",-1),Fe=["value"],Me={key:0,class:"invalid-feedback"},Ne={class:"col-2"},Se={class:"input-group"},xe=["onUpdate:modelValue"],qe=e("span",{class:"input-group-text"},"Kg",-1),Ee={key:0,class:"invalid-feedback d-block"},Ie={key:1,class:"invalid-feedback d-block"},Le={class:"col-2"},Re={class:"input-group"},Te=["onUpdate:modelValue"],Ge=e("span",{class:"input-group-text"},"kg",-1),Ke={key:0,class:"invalid-feedback d-block"},Oe=["disabled"],Pe={key:0,class:"spinner-border spinner-border-sm me-2"},We={__name:"FeedingCurveForm",setup(je){const N=K(),S=O(),k=new C("/feeding-curves"),x=new C("/formulas"),y=f(null),w=f([]),p=f(null),h=f(null),a=U({name:"",description:"",is_active:!0,details:[]}),q=async()=>{const r=await k.get(y.value);Object.assign(a,r.data),a.details&&a.details.length>0&&(p.value=a.details[0].age_day,h.value=a.details[a.details.length-1].age_day)},E=async()=>{const r=await x.getList();w.value=r.data.items.map(d=>({label:d.name,value:d.id}))||[]};P(async()=>{y.value=S.params.id,y.value&&await q(),await E()});const I=U({name:{required:g},description:{required:g},is_active:{required:g},details:{$each:Q.forEach({day:{required:g,minValue:V(1)},formula_id:{required:g},formula_mass_per_animal:{required:g,minValue:V(1)},animal_weight:{minValue:V(0)}})}}),t=W(I,a),L=()=>{if(!(!p.value||!h.value||h.value<p.value)){a.details=[];for(let r=p.value;r<=h.value;r++)a.details.push({age_day:r,formula_id:null,formula_mass_per_animal:0,is_active:!0})}},R=r=>{X(r,"Curva salva com sucesso"),r.success&&N.push({name:"feeding-curves"})},l=f(!1),$=f(!1),T=async()=>{if(t.value.$touch(),l.value=!0,!t.value.$invalid){$.value=!0;try{const r=y.value?await k.update(y.value,a):await k.save(a);R(r)}finally{$.value=!1}}};return(r,d)=>{const G=j("BaseBlock");return i(),n("div",Y,[z(G,{title:"Curva de Alimenta\xE7\xE3o"},{default:J(()=>[e("div",Z,[ee,_(e("input",{"onUpdate:modelValue":d[0]||(d[0]=s=>a.name=s),type:"text",class:b(["form-control",{"is-invalid":o(t).name.$error&&l.value}])},null,2),[[v,a.name]]),o(t).name.$error&&l.value?(i(),n("div",ae,"Campo obrigat\xF3rio")):m("",!0)]),e("div",se,[te,_(e("input",{"onUpdate:modelValue":d[1]||(d[1]=s=>a.description=s),type:"text",class:b(["form-control",{"is-invalid":o(t).description.$error&&l.value}])},null,2),[[v,a.description]]),o(t).description.$error&&l.value?(i(),n("div",oe,"Campo obrigat\xF3rio")):m("",!0)]),e("div",le,[ie,_(e("select",{"onUpdate:modelValue":d[2]||(d[2]=s=>a.is_active=s),class:b(["form-select",{"is-invalid":o(t).is_active.$error&&l.value}])},de,2),[[D,a.is_active]]),o(t).is_active.$error&&l.value?(i(),n("div",ce," Campo obrigat\xF3rio ")):m("",!0)]),e("div",ue,[e("div",_e,[me,_(e("input",{"onUpdate:modelValue":d[3]||(d[3]=s=>p.value=s),type:"number",min:"1",class:"form-control"},null,512),[[v,p.value]])]),e("div",ve,[pe,_(e("input",{"onUpdate:modelValue":d[4]||(d[4]=s=>h.value=s),type:"number",min:"1",class:"form-control"},null,512),[[v,h.value]])]),e("div",{class:"col-auto d-flex align-items-end"},[e("button",{type:"button",class:"btn btn-success",onClick:L}," Gerar Linhas ")])]),a.details.length>0?(i(),n("div",he,ke)):m("",!0),(i(!0),n(B,null,A(a.details,(s,u)=>(i(),n("div",{key:u,class:"row g-2 align-items-start mb-2"},[e("div",Ve,[e("span",we,F(u+1),1)]),e("div",Ce,[_(e("input",{"onUpdate:modelValue":c=>s.age_day=c,type:"text",class:"form-control",disabled:""},null,8,Ue),[[v,s.age_day]])]),e("div",De,[_(e("select",{"onUpdate:modelValue":c=>s.formula_id=c,class:b(["form-select",{"is-invalid":o(t).details.$each.$response.$data[u].formula_id.$error&&l.value}])},[Ae,(i(!0),n(B,null,A(w.value,c=>(i(),n("option",{key:c.value,value:c.value},F(c.label),9,Fe))),128))],10,Be),[[D,s.formula_id]]),o(t).details.$each.$response.$data[u].formula_id.$error&&l.value?(i(),n("div",Me," Campo obrigat\xF3rio ")):m("",!0)]),e("div",Ne,[e("div",Se,[_(e("input",{"onUpdate:modelValue":c=>s.formula_mass_per_animal=c,step:"0.01",class:b(["form-control",{"is-invalid":o(t).details.$each.$response.$data[u].formula_mass_per_animal.$error&&l.value}]),"data-maska":"###.##",placeholder:"Massa"},null,10,xe),[[v,s.formula_mass_per_animal],[o(M)]]),qe]),!o(t).details.$each.$response.$data[u].formula_mass_per_animal.required&&l.value?(i(),n("div",Ee," Campo obrigat\xF3rio ")):!o(t).details.$each.$response.$data[u].formula_mass_per_animal.minValue&&l.value?(i(),n("div",Ie," Valor m\xEDnimo: 1 ")):m("",!0)]),e("div",Le,[e("div",Re,[_(e("input",{"onUpdate:modelValue":c=>s.animal_weight=c,type:"text",step:"0.01",class:b(["form-control",{"is-invalid":o(t).details.$each.$response.$data[u].animal_weight.$error&&l.value}]),"data-maska":"###.#",placeholder:"Peso"},null,10,Te),[[v,s.animal_weight],[o(M)]]),Ge]),o(t).details.$each.$response.$data[u].animal_weight.$error&&l.value?(i(),n("div",Ke," Valor inv\xE1lido ")):m("",!0)])]))),128)),e("button",{onClick:T,class:"btn btn-primary mb-4 btn-lg",disabled:$.value},[$.value?(i(),n("span",Pe)):m("",!0),H(" Salvar ")],8,Oe)]),_:1})])}}};export{We as default};
