import{A as G,u as N,r,s as j,o as F,a as H,b as m,e as p,g as _,d as e,t as i,h as L,m as T,n as S,F as I,f as q,i as z}from"./index.1cfa7469.js";import{S as E}from"./SVGView.5ed4cae1.js";import{_ as M}from"./SVGPanel.9188e62e.js";import{h as g}from"./toast.022af5e3.js";import{_ as Z}from"./Loader.7b3789d0.js";class J extends G{constructor(){super("/installations")}async healthCheck(n){try{return(await this.api.post(`${this.path}/${n}/health-check`)).data}catch(a){return a.response}}async restart(n){try{return(await this.api.post(`${this.path}/${n}/restart`)).data}catch(a){return a.response}}async togglePin(n,a){try{return(await this.api.post(`${this.path}/${n}/toggle-pin/${a}`)).data}catch(c){return c.response}}}const K=h=>{const n=new Date(h);return n.setHours(n.getHours()-3),n.toLocaleString("pt-BR",{timeZone:"America/Sao_Paulo",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})},Q={class:"device-page container mt-5"},U={key:0,class:"text-center"},W={class:"d-flex justify-content-between align-items-center mb-3"},X={class:"me-3"},Y={class:"pins-layout mt-4"},ee=e("h4",null,"V\xE1lvulas",-1),te={class:"row"},ae=["onClick"],se={class:"my-4"},ue={__name:"Installation",setup(h){const n=N(),a=new J,c=new E,o=r(!1),s=r(null),y=r(n.query.id||null),P=async t=>{o.value.loaderOn();const l=await a.togglePin(s.value.id,t.id);g(l,`${t.name} ${t.is_active?"desligado":"ativado"} com sucesso`),await d(),o.value.loaderOff()},B=j(()=>{var t;return(t=s.value)!=null&&t.is_online?"text-success":"text-danger"}),A=async()=>{o.value.loaderOn();const t=await a.healthCheck(s.value.id);g(t,"Conex\xE3o verificada com sucesso"),await d(),o.value.loaderOff()},D=async()=>{o.value.loaderOn();const t=await a.restart(s.value.id);g(t,"Dispositivo reiniciado com sucesso"),await d(),o.value.loaderOff()},u=r(null),R=async()=>{var l;const t=await c.getOwnerSvgId("installations",s.value.id);u.value=((l=t.data)==null?void 0:l.svg_id)||null,u.value&&(await z(),f.value&&await f.value.refresh())},f=r(null),d=async()=>{if(o.value.loaderOn(),!y.value)return;const t=await a.get(y.value);s.value=t.data,await R(),o.value.loaderOff()};return F(async()=>{await d()}),(t,l)=>{var b,k,C,O,$,x,V;const w=H("mdicon");return m(),p(I,null,[_(Z,{ref_key:"loader",ref:o},null,512),e("div",Q,[e("h2",null,"Placa: "+i((b=s.value)==null?void 0:b.name),1),e("p",null,"IP: "+i((k=s.value)==null?void 0:k.ip_address),1),u.value?(m(),p("div",U,[_(M,{ref_key:"SVGPanelRef",ref:f,svgId:u.value},null,8,["svgId"])])):L("",!0),e("div",W,[e("div",null,[e("span",X," \xDAltimo acesso: "+i(T(K)((C=s.value)==null?void 0:C.last_seen)||"-"),1),e("span",{class:S(B.value)},i((O=s.value)!=null&&O.is_online?"Online":"Offline"),3)]),e("div",null,[e("button",{class:"btn btn-info btn-lg me-2",title:"Verificar conex\xE3o",onClick:A},[_(w,{name:"check"})]),e("button",{class:"btn btn-warning btn-lg",title:"Reiniciar dispositivo",onClick:D},[_(w,{name:"restart"})])])]),e("div",Y,[ee,e("div",te,[(m(!0),p(I,null,q(($=s.value)==null?void 0:$.pins,v=>(m(),p("div",{key:v.id,class:"col-6 col-md-2 mb-3 text-center position-relative"},[e("button",{class:S(["btn w-100 position-relative",v.is_active?"btn-success":"btn-danger"]),onClick:ne=>P(v)},i(v.name),11,ae)]))),128))])]),e("div",se,[e("small",null," Valor bin\xE1rio: "+i((x=s.value)==null?void 0:x.binary_value)+" | Valor decimal: "+i((V=s.value)==null?void 0:V.decimal_value),1)])])],64)}}};export{ue as default};
