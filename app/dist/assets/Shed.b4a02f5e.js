import{_ as O,u as R,A as f,r as A,q as E,o as U,b as c,e as r,d as e,t as b,m as N,F as C,f as w,G as j,g as Z,a_ as z,aZ as H}from"./index.89030e27.js";import{B as J}from"./BaseModalForm.40ff7a64.js";import{h as K}from"./toast.f384bd24.js";import{_ as D}from"./PinSelect.2d403ee0.js";import"./index.09277535.js";import"./Loader.6d6636c9.js";const l=v=>(z("data-v-7ea2d580"),v=v(),H(),v),Q={class:"container py-4"},W={class:"mb-4"},X={class:"d-flex justify-content-between align-items-center mb-2"},Y={class:"mb-0"},ee=["data-bs-target","aria-controls"],te=l(()=>e("i",{class:"fa fa-chevron-down"},null,-1)),se=[te],ne=["onClick"],ae=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),oe=[ae],le=["onClick"],ie=l(()=>e("i",{class:"fa fa-trash"},null,-1)),de=[ie],ce=["onClick"],re=["id"],_e={class:"d-flex justify-content-between align-items-center"},ue=["onClick"],me=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),be=[me],pe=["onClick"],he=l(()=>e("i",{class:"fa fa-trash"},null,-1)),fe=[he],ve=["onClick"],ye={class:"d-flex justify-content-between align-items-center"},ge=["onClick"],ke=l(()=>e("i",{class:"fa fa-pencil"},null,-1)),Ce=[ke],we=["onClick"],xe=l(()=>e("i",{class:"fa fa-trash"},null,-1)),Ie=[xe],$e=["onClick"],Se={class:"mt-2 ms-3 row"},Ae={class:"btn btn-lg btn-primary disabled me-2"},Pe=["onClick"],Ve=l(()=>e("i",{class:"fa fa-trash"},null,-1)),qe=[Ve],Be={class:"modal fade",id:"modal-delete",tabindex:"-1"},Ee={class:"modal-dialog"},Ne={class:"modal-content"},je=l(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Confirmar A\xE7\xE3o"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),De={class:"modal-body"},Fe=l(()=>e("button",{class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),Me={__name:"Shed",setup(v){const F=R(),M=new f("/sheds"),P=new f("/salas"),V=new f("/baias"),q=new f("/comedouros"),x=new f("/feeder-valves"),I=F.query.id,y=A({}),B=A(null),a=E({type:null,entity:null,parentId:null}),i=E({type:null,entity:null}),L=async n=>(await x.getList({comedouro_id:n})).data.items||[],$=async()=>{var t;const n=await M.get(I);y.value=n.data||{},(t=y.value.salas)==null||t.forEach(u=>{var p;(p=u.baias)==null||p.forEach(k=>{var h;(h=k.comedouros)==null||h.forEach(async s=>{s.device_pins=await L(s.id)})})})};U(async()=>{await $()});const _=(n,t=null,u=null)=>{Object.assign(a,{type:n,entity:t!=null?t:{},parentId:u}),B.value.openModal()},T=async()=>{await $()},g=(n,t)=>{i.type=n,i.entity=t,new bootstrap.Modal(document.getElementById("modal-delete")).show()},G=async()=>{let n;i.type==="sala"?n=P:i.type==="baia"?n=V:i.type==="comedouro"?n=q:n=x;const t=await n.delete(i.entity.id);K(t,"Item exclu\xEDdo com sucesso"),t.success&&(await $(),i.type=null,i.entity=null)},S=A({sala:{api:P,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"entrance_pin_id",label:"Pino de Entrada",component:D}],extraPayload:()=>({shed_id:a.parentId})},baia:{api:V,fields:[{name:"name",label:"Nome",type:"text",rules:"required"}],extraPayload:()=>({sala_id:a.parentId})},comedouro:{api:q,fields:[{name:"name",label:"Nome",type:"text",rules:"required"},{name:"max_weight",label:"Peso m\xE1ximo (kg)",type:"number",rules:"required|numeric|min:0"}],extraPayload:()=>({baia_id:a.parentId})},valve:{api:x,fields:[{name:"device_pin_id",label:"Pino do Dispositivo",component:D,rules:"required"}],extraPayload:()=>({comedouro_id:a.parentId})}});return(n,t)=>{var u,p,k,h;return c(),r("div",Q,[e("h3",W,b(y.value.name),1),e("button",{class:"btn btn-success mb-3",onClick:t[0]||(t[0]=s=>_("sala",null,N(I)))}," + Sala "),(c(!0),r(C,null,w(y.value.salas,s=>(c(),r("div",{key:s.id,class:"card mb-3 p-3 shadow-sm sala-card"},[e("div",X,[e("h5",Y,b(s.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-info me-1",type:"button","data-bs-toggle":"collapse","data-bs-target":"#sala-"+s.id,"aria-expanded":"true","aria-controls":"sala-"+s.id},se,8,ee),e("button",{class:"btn btn-lg btn-warning",onClick:o=>_("sala",s,N(I))},oe,8,ne),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:o=>g("sala",s)},de,8,le),e("button",{class:"btn btn-lg btn-success ms-1",onClick:o=>_("baia",null,s.id)}," + Baia ",8,ce)])]),e("div",{class:"collapse",id:"sala-"+s.id},[(c(!0),r(C,null,w(s.baias,o=>(c(),r("div",{key:o.id,class:"card mb-2 ms-3 p-2 shadow-sm baia-card"},[e("div",_e,[e("strong",null,b(o.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:d=>_("baia",o,s.id)},be,8,ue),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:d=>g("baia",o)},fe,8,pe),e("button",{class:"btn btn-lg btn-success ms-1",onClick:d=>_("comedouro",null,o.id)}," + Comedouro ",8,ve)])]),(c(!0),r(C,null,w(o.comedouros,d=>(c(),r("div",{key:d.id,class:"card mt-2 ms-3 p-2 comedouro-card"},[e("div",ye,[e("span",null,b(d.name),1),e("div",null,[e("button",{class:"btn btn-lg btn-warning",onClick:m=>_("comedouro",d,o.id)},Ce,8,ge),e("button",{class:"btn btn-lg btn-danger ms-1",onClick:m=>g("comedouro",d)},Ie,8,we),e("button",{class:"btn btn-lg btn-success ms-1",onClick:m=>_("valve",null,d.id)}," + V\xE1lvula ",8,$e)])]),e("div",Se,[(c(!0),r(C,null,w(d.device_pins,m=>(c(),r("div",{key:m.id,class:"d-flex align-items-center mb-1 col-auto"},[e("button",Ae,b(m.device_pin.name),1),e("button",{class:"btn btn-lg btn-danger",onClick:Le=>g("feeder-valves",m)},qe,8,Pe)]))),128))])]))),128))]))),128))],8,re)]))),128)),e("div",Be,[e("div",Ee,[e("div",Ne,[je,e("div",De,[j(" Deseja realmente excluir "),e("strong",null,b(((u=i.entity)==null?void 0:u.name)||"este item"),1),j("? ")]),e("div",{class:"modal-footer"},[Fe,e("button",{class:"btn btn-danger","data-bs-dismiss":"modal",onClick:G},"Confirmar")])])])]),Z(J,{ref_key:"modalForm",ref:B,modelValue:a.entity,"onUpdate:modelValue":t[1]||(t[1]=s=>a.entity=s),fields:((p=S.value[a.type])==null?void 0:p.fields)||[],api:((k=S.value[a.type])==null?void 0:k.api)||{},"extra-payload":(h=S.value[a.type])==null?void 0:h.extraPayload(),onSaved:T},null,8,["modelValue","fields","api","extra-payload"])])}}},ze=O(Me,[["__scopeId","data-v-7ea2d580"]]);export{ze as default};
